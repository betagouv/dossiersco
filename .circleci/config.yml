version: 2
jobs:
  build:
    docker:
      - image: circleci/ruby
        environment:
          POSTGRES_HOST: localhost
          POSTGRES_DB: dossiersco
          POSTGRES_USER: dossiersco
          POSTGRES_PASSWORD: dossiersco
      - image: circleci/postgres
        environment:
          POSTGRES_DB: dossiersco
          POSTGRES_USER: dossiersco
          POSTGRES_PASSWORD: dossiersco
    working_directory: ~/dossiersco
    steps:
      - checkout

      - run:
          name: Install Dependencies
          command: bundle

      - run:
          name: Run unit tests
          command: rake db:migrate db:seed && ruby tests/test_famille.rb && ruby tests/test_agent.rb
