<div class="col-12 col-md-8">

    <h2 class="separation">Options de l'établissement</h2>

  <% if defined? message  %>
    <div class="message_echec"><%= message %></div>
  <% end %>

<table class="table table-striped table-sm">
  <thead>
    <tr>
        <th>nom</th>
        <th>début</th>
        <th>obligatoire</th>
        <th>groupe</th>
        <th></th>
    </tr>
  </thead>
  <tbody>
    <% options.each do |option| %>
      <tr>
        <td><%= option.nom %></td>
        <td><%= option.niveau_debut %>ème</td>
        <td><%= option.obligatoire ? 'Oui': 'Non'%></td>
        <td><%= option.groupe %></td>
        <td><i class="fas fa-trash-alt" style="color: #BB0000; cursor: pointer" data-id='<%= option.id %>'></i></td>
      </tr>
    <% end %>
  </tbody>
</table>
    <form action='/agent/options' method='POST'>
      <label for='nom'>Nom</label>
      <input name='nom' type='text' placeholder='Ex : Latin' />
      <label for='niveau_debut' style='margin-left:10px'>Niveau de début</label>
      <input name='niveau_debut' type='text' placeholder='Ex : 4' />
      <label for='obligatoire' style='margin-left:10px'>Obligatoire</label>
      <input id='obligatoire' name='obligatoire' type='checkbox' value='true' />
      <input id='groupe' name='groupe' type='text' class='d-none' placeholder='Ex : Langue vivante 2' />
      <button class='btn btn-primary' type='submit' style='margin-left:10px'>Ajouter</button>
    </form>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8">
  $('#obligatoire').click(function() {
    if ( $('#obligatoire').is(':checked') ) {
      $('#groupe').removeClass('d-none')
    } else {
      $('#groupe').addClass('d-none')
    }
  });
  $('.fa-trash-alt').click(function() {
    var $this = $(this);
    var option_id = $this.data('id');
    $.ajax({
      method: "POST",
      url: "/agent/supprime_option",
      data: { option_id: option_id },
      success : function() {
        console.log($this.parent().parent());
          $this.parent().parent().remove()
      }
    });
  })
</script>