<div class="col-12 col-10">

  <span style="display:block; height: 50px;"></span>

  <div class="container">
    <div class="row">
      <div class="col-2">
      </div>
      <div class="col">
        <h1>Eleves en cours de traitement</h1>
        <hr>
      </div>
    </div>
  </div>

  <span style="display:block; height: 20px;"></span>

  <table class="table table-striped table-bordered table-condensed table-hover">
    <thead><tr>
      <th>Identifiant</th>
      <th>Pr√©nom</th>
      <th>Nom</th>
      <th>Etat</th>
      <th>Photo</th>
      <th>Assurance</th>
      <th>Garde</th>
    </tr></thead>
    <tbody>
      <% dossier_eleves.each do |dossier_eleve| %>
        <tr id="<%= dossier_eleve.id %>">
          <th><%= dossier_eleve.eleve.identifiant %></th>
          <th><%= dossier_eleve.eleve.prenom %></th>
          <th><%= dossier_eleve.eleve.nom %></th>
          <th><%= dossier_eleve.etat %></th>
          <th class="text-center" data-nom-fichier="etat_photo_identite">
            <% if dossier_eleve.photo_identite.present? %>
              <a href="<%= dossier_eleve.photo_identite %>">
                <i class="fas fa-file-image"></i>
              </a>
              <i class="fas fa-check-circle etat" style="<%= 'color: lightgreen' if dossier_eleve.etat_photo_identite == 'valide' %>"></i>
              <i class="fas fa-times-circle etat" style="<%= 'color: red' if dossier_eleve.etat_photo_identite == 'invalide' %>"></i>
            <% end %>
          </th>
          <th class="text-center" data-nom-fichier="etat_assurance_scolaire">
            <% if dossier_eleve.assurance_scolaire.present? %>
              <a href="<%= dossier_eleve.assurance_scolaire %>">
                <i class="fas fa-file-image"></i>
              </a>
              <i class="fas fa-check-circle etat" style="<%= 'color: lightgreen' if dossier_eleve.etat_assurance_scolaire == 'valide' %>"></i>
              <i class="fas fa-times-circle etat" style="<%= 'color: red' if dossier_eleve.etat_assurance_scolaire == 'invalide' %>"></i>
            <% end %>
          </th>
          <th class="text-center" data-nom-fichier="etat_jugement_garde_enfant">
            <% if dossier_eleve.jugement_garde_enfant.present? %>
              <a href="<%= dossier_eleve.jugement_garde_enfant %>">
                <i class="fas fa-file-image"></i>
              </a>
              <i class="fas fa-check-circle etat" style="<%= 'color: lightgreen' if dossier_eleve.etat_assurance_scolaire == 'valide' %>"></i>
              <i class="fas fa-times-circle etat" style="<%= 'color: red' if dossier_eleve.etat_assurance_scolaire == 'invalide' %>"></i>
            <% end %>
          </th>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" charset="utf-8">
  $('.etat').click(function() {
      var id = $(this).parent().parent().attr('id');
      var nom_fichier = $(this).parent().data('nom-fichier');
      if ($(this).hasClass('fa-check-circle')) {
          var etat = 'valide';
          $(this).css('color', '#00ff0c');
      } else {
          var etat = 'invalide';
          $(this).css('color', 'red');
      }
    $.ajax({
        method: "POST",
        url: "/agent/change_etat_fichier",
        data: { id: id, nom_fichier: nom_fichier, etat: etat}
    })
  })
</script>
