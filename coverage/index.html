<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for App</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.2/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.2/favicon_yellow.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.2/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2019-01-14T16:49:53+00:00">2019-01-14T16:49:53+00:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="yellow">84.89%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         17.61
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>32</b> files in total.
    <b>801</b> relevant lines. 
    <span class="green"><b>680</b> lines covered</span> and
    <span class="red"><b>121</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#01c2bd24ac7b09f89bb61635fe3b7b7bf2d3fd6b" class="src_link" title="app/channels/application_cable/channel.rb">app/channels/application_cable/channel.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>4</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e6aae32585db7912e4d3e4e3b65dde41e9cc6b46" class="src_link" title="app/channels/application_cable/connection.rb">app/channels/application_cable/connection.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>4</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8903c508926939992a4bda236819f00f026196cc" class="src_link" title="app/controllers/accueil_controller.rb">app/controllers/accueil_controller.rb</a></td>
        <td class="red strong">79.59 %</td>
        <td>303</td>
        <td>196</td>
        <td>156</td>
        <td>40</td>
        <td>9.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#67d8f4f56b98a41ec0384f715547f7e146b97d14" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#156d8b103c28ce8a4187d7b3a73a91998aad2d98" class="src_link" title="app/controllers/eleves_controller.rb">app/controllers/eleves_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#118ae267dcfd23628c5aafa07786ebb11f1d9917" class="src_link" title="app/controllers/inscriptions_controller.rb">app/controllers/inscriptions_controller.rb</a></td>
        <td class="red strong">72.82 %</td>
        <td>350</td>
        <td>195</td>
        <td>142</td>
        <td>53</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d9bb6ae4328bef863171723d65f913f9c3803bfe" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>184.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ea2c786176cae412887a725747f7e6c862cf5be0" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>2</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8b94d0b74b29d3c2848996939cc2960327cd34f1" class="src_link" title="app/mailers/agent_mailer.rb">app/mailers/agent_mailer.rb</a></td>
        <td class="yellow strong">82.61 %</td>
        <td>53</td>
        <td>23</td>
        <td>19</td>
        <td>4</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#db1bc6aef95690a1f3b4d378c7f61adc8b8d50a4" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4ecc8f2960750c6d9cb852c10ddd850521a4dddf" class="src_link" title="app/models/abandon.rb">app/models/abandon.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>5</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#06939284f208bc46f9485d7170475d6a2200e19e" class="src_link" title="app/models/abandonnabilite.rb">app/models/abandonnabilite.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#991bc9f53bf44164fb8ae2b04678a74083f06570" class="src_link" title="app/models/agent.rb">app/models/agent.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2c5f70c0710b67d4338de4845d83cd2187f429f2" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>3</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d5690fbe0b3b04eff5b766cf59517ff78e353ccb" class="src_link" title="app/models/contact_urgence.rb">app/models/contact_urgence.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0e16b34ca223206b7f6e797877d00ebc95d7fbf8" class="src_link" title="app/models/demandabilite.rb">app/models/demandabilite.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5e139ec46f25245b704b894869cae4204dfb1385" class="src_link" title="app/models/demande.rb">app/models/demande.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>5</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cdf636f0633a00a046af3758191c95c07b4ddcb8" class="src_link" title="app/models/dossier_eleve.rb">app/models/dossier_eleve.rb</a></td>
        <td class="green strong">92.68 %</td>
        <td>67</td>
        <td>41</td>
        <td>38</td>
        <td>3</td>
        <td>6.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c9fc941cca82df9e2f27af57b3128db123959aa0" class="src_link" title="app/models/eleve.rb">app/models/eleve.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>102</td>
        <td>53</td>
        <td>53</td>
        <td>0</td>
        <td>8.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#af87c13869d589b070189a4981258658d368953f" class="src_link" title="app/models/etablissement.rb">app/models/etablissement.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>5.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe6f6c5cc0136098f7e664b99d4188fef49b0d72" class="src_link" title="app/models/message.rb">app/models/message.rb</a></td>
        <td class="green strong">95.83 %</td>
        <td>45</td>
        <td>24</td>
        <td>23</td>
        <td>1</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b688569f24114184179379e577583f2b1d48c7b0" class="src_link" title="app/models/modele.rb">app/models/modele.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ae319a27d860cd3f30ad8abbd0ca4f3a2622e75" class="src_link" title="app/models/montee.rb">app/models/montee.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c0b15737d76f53447c191b74aaa5b36cc783b1a8" class="src_link" title="app/models/option.rb">app/models/option.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe8ad0d27a7a60e38c56a47c3cef7ca7bd5ff0f4" class="src_link" title="app/models/piece_attendue.rb">app/models/piece_attendue.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#007448c5efd98fbe4d9cf530a2900e301c0ff1c6" class="src_link" title="app/models/piece_jointe.rb">app/models/piece_jointe.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dc8550cd58aec5d55149b7e2d92685b23c171aee" class="src_link" title="app/models/resp_legal.rb">app/models/resp_legal.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>33.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#38c9a32cd79e121d7d3dd3dec05c3044e2da6a81" class="src_link" title="app/models/tache_import.rb">app/models/tache_import.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e9de6ab54b3ed646581e6ac16f8599fc1280a47a" class="src_link" title="app/models/trace.rb">app/models/trace.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b86887dc0eb56335344883cc6b7fb3ff7797e7af" class="src_link" title="app/uploaders/fichier_uploader.rb">app/uploaders/fichier_uploader.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>12</td>
        <td>7</td>
        <td>6</td>
        <td>1</td>
        <td>3.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#74c09cb88b9dca3b72fcf39f0c0bc913f8f63777" class="src_link" title="lib/import_siecle.rb">lib/import_siecle.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>195</td>
        <td>101</td>
        <td>101</td>
        <td>0</td>
        <td>86.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dde11c2785996ef3d12577dbb43c6f5f822fecd6" class="src_link" title="lib/traitement.rb">lib/traitement.rb</a></td>
        <td class="yellow strong">89.09 %</td>
        <td>82</td>
        <td>55</td>
        <td>49</td>
        <td>6</td>
        <td>1.4</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="red">76.28%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         7.29
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>4</b> files in total.
    <b>392</b> relevant lines. 
    <span class="green"><b>299</b> lines covered</span> and
    <span class="red"><b>93</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#8903c508926939992a4bda236819f00f026196cc" class="src_link" title="app/controllers/accueil_controller.rb">app/controllers/accueil_controller.rb</a></td>
        <td class="red strong">79.59 %</td>
        <td>303</td>
        <td>196</td>
        <td>156</td>
        <td>40</td>
        <td>9.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#67d8f4f56b98a41ec0384f715547f7e146b97d14" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#156d8b103c28ce8a4187d7b3a73a91998aad2d98" class="src_link" title="app/controllers/eleves_controller.rb">app/controllers/eleves_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#118ae267dcfd23628c5aafa07786ebb11f1d9917" class="src_link" title="app/controllers/inscriptions_controller.rb">app/controllers/inscriptions_controller.rb</a></td>
        <td class="red strong">72.82 %</td>
        <td>350</td>
        <td>195</td>
        <td>142</td>
        <td>53</td>
        <td>4.8</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="green">96.6%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         7.73
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>19</b> files in total.
    <b>206</b> relevant lines. 
    <span class="green"><b>199</b> lines covered</span> and
    <span class="red"><b>7</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#4ecc8f2960750c6d9cb852c10ddd850521a4dddf" class="src_link" title="app/models/abandon.rb">app/models/abandon.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>5</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#06939284f208bc46f9485d7170475d6a2200e19e" class="src_link" title="app/models/abandonnabilite.rb">app/models/abandonnabilite.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#991bc9f53bf44164fb8ae2b04678a74083f06570" class="src_link" title="app/models/agent.rb">app/models/agent.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2c5f70c0710b67d4338de4845d83cd2187f429f2" class="src_link" title="app/models/application_record.rb">app/models/application_record.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>3</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d5690fbe0b3b04eff5b766cf59517ff78e353ccb" class="src_link" title="app/models/contact_urgence.rb">app/models/contact_urgence.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0e16b34ca223206b7f6e797877d00ebc95d7fbf8" class="src_link" title="app/models/demandabilite.rb">app/models/demandabilite.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5e139ec46f25245b704b894869cae4204dfb1385" class="src_link" title="app/models/demande.rb">app/models/demande.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>5</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cdf636f0633a00a046af3758191c95c07b4ddcb8" class="src_link" title="app/models/dossier_eleve.rb">app/models/dossier_eleve.rb</a></td>
        <td class="green strong">92.68 %</td>
        <td>67</td>
        <td>41</td>
        <td>38</td>
        <td>3</td>
        <td>6.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c9fc941cca82df9e2f27af57b3128db123959aa0" class="src_link" title="app/models/eleve.rb">app/models/eleve.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>102</td>
        <td>53</td>
        <td>53</td>
        <td>0</td>
        <td>8.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#af87c13869d589b070189a4981258658d368953f" class="src_link" title="app/models/etablissement.rb">app/models/etablissement.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>5.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe6f6c5cc0136098f7e664b99d4188fef49b0d72" class="src_link" title="app/models/message.rb">app/models/message.rb</a></td>
        <td class="green strong">95.83 %</td>
        <td>45</td>
        <td>24</td>
        <td>23</td>
        <td>1</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b688569f24114184179379e577583f2b1d48c7b0" class="src_link" title="app/models/modele.rb">app/models/modele.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>3</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3ae319a27d860cd3f30ad8abbd0ca4f3a2622e75" class="src_link" title="app/models/montee.rb">app/models/montee.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c0b15737d76f53447c191b74aaa5b36cc783b1a8" class="src_link" title="app/models/option.rb">app/models/option.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fe8ad0d27a7a60e38c56a47c3cef7ca7bd5ff0f4" class="src_link" title="app/models/piece_attendue.rb">app/models/piece_attendue.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#007448c5efd98fbe4d9cf530a2900e301c0ff1c6" class="src_link" title="app/models/piece_jointe.rb">app/models/piece_jointe.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dc8550cd58aec5d55149b7e2d92685b23c171aee" class="src_link" title="app/models/resp_legal.rb">app/models/resp_legal.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>56</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>33.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#38c9a32cd79e121d7d3dd3dec05c3044e2da6a81" class="src_link" title="app/models/tache_import.rb">app/models/tache_import.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>3.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e9de6ab54b3ed646581e6ac16f8599fc1280a47a" class="src_link" title="app/models/trace.rb">app/models/trace.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>2</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="yellow">84.62%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         3.65
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>2</b> files in total.
    <b>26</b> relevant lines. 
    <span class="green"><b>22</b> lines covered</span> and
    <span class="red"><b>4</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#8b94d0b74b29d3c2848996939cc2960327cd34f1" class="src_link" title="app/mailers/agent_mailer.rb">app/mailers/agent_mailer.rb</a></td>
        <td class="yellow strong">82.61 %</td>
        <td>53</td>
        <td>23</td>
        <td>19</td>
        <td>4</td>
        <td>4.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#db1bc6aef95690a1f3b4d378c7f61adc8b8d50a4" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         184.8
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>1</b> files in total.
    <b>4</b> relevant lines. 
    <span class="green"><b>4</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#d9bb6ae4328bef863171723d65f913f9c3803bfe" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>184.8</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent"><span class="red">0.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Jobs"></a>
  <div>
    <b>1</b> files in total.
    <b>2</b> relevant lines. 
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>2</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#ea2c786176cae412887a725747f7e6c862cf5be0" class="src_link" title="app/jobs/application_job.rb">app/jobs/application_job.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>2</td>
        <td>2</td>
        <td>0</td>
        <td>2</td>
        <td>0.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">96.15%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         56.43
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>2</b> files in total.
    <b>156</b> relevant lines. 
    <span class="green"><b>150</b> lines covered</span> and
    <span class="red"><b>6</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#74c09cb88b9dca3b72fcf39f0c0bc913f8f63777" class="src_link" title="lib/import_siecle.rb">lib/import_siecle.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>195</td>
        <td>101</td>
        <td>101</td>
        <td>0</td>
        <td>86.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#dde11c2785996ef3d12577dbb43c6f5f822fecd6" class="src_link" title="lib/traitement.rb">lib/traitement.rb</a></td>
        <td class="yellow strong">89.09 %</td>
        <td>82</td>
        <td>55</td>
        <td>49</td>
        <td>6</td>
        <td>1.4</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent"><span class="red">40.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         1.45
       </span>
    </span> hits/line)
  </h2>
  <a name="Ungrouped"></a>
  <div>
    <b>3</b> files in total.
    <b>15</b> relevant lines. 
    <span class="green"><b>6</b> lines covered</span> and
    <span class="red"><b>9</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#01c2bd24ac7b09f89bb61635fe3b7b7bf2d3fd6b" class="src_link" title="app/channels/application_cable/channel.rb">app/channels/application_cable/channel.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>4</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e6aae32585db7912e4d3e4e3b65dde41e9cc6b46" class="src_link" title="app/channels/application_cable/connection.rb">app/channels/application_cable/connection.rb</a></td>
        <td class="red strong">0.0 %</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>4</td>
        <td>0.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b86887dc0eb56335344883cc6b7fb3ff7797e7af" class="src_link" title="app/uploaders/fichier_uploader.rb">app/uploaders/fichier_uploader.rb</a></td>
        <td class="yellow strong">85.71 %</td>
        <td>12</td>
        <td>7</td>
        <td>6</td>
        <td>1</td>
        <td>3.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.16.1 
        and simplecov-html v0.10.2<br/>
        using Integration Tests
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="01c2bd24ac7b09f89bb61635fe3b7b7bf2d3fd6b">
  <div class="header">
    <h3>app/channels/application_cable/channel.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">module ApplicationCable</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  class Channel &lt; ActionCable::Channel::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e6aae32585db7912e4d3e4e3b65dde41e9cc6b46">
  <div class="header">
    <h3>app/channels/application_cable/connection.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">module ApplicationCable</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  class Connection &lt; ActionCable::Connection::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8903c508926939992a4bda236819f00f026196cc">
  <div class="header">
    <h3>app/controllers/accueil_controller.rb</h3>
    <h4><span class="red">79.59 %</span> covered</h4>
    <div>
      <b>196</b> relevant lines. 
      <span class="green"><b>156</b> lines covered</span> and
      <span class="red"><b>40</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;traitement&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class AccueilController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :verifie_identité, except: [:index, :identification, :stats]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def index</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def identification</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="10">
          <span class="hits">44</span>
          
          <code class="ruby">    if params[:identifiant].empty? || params[:annee].empty? || params[:mois].empty? || params[:jour].empty?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">      session[:message_erreur] = &quot;Veuillez renseigner l&#39;identifiant et la date de naissance de l&#39;élève.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">      redirect_to &#39;/&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="14">
          <span class="hits">44</span>
          
          <code class="ruby">    Trace.create(identifiant: params[:identifiant],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">                 categorie: &#39;famille&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">                 page_demandee: request.path_info,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">                 adresse_ip: request.ip)</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="18">
          <span class="hits">44</span>
          
          <code class="ruby">    identifiant = normalise_alphanum params[:identifiant]</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="19">
          <span class="hits">44</span>
          
          <code class="ruby">    dossier_eleve = get_dossier_eleve identifiant</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="21">
          <span class="hits">44</span>
          
          <code class="ruby">    date_saisie = &quot;#{params[:annee]}-#{params[:mois]}-#{params[:jour]}&quot;</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="22">
          <span class="hits">44</span>
          
          <code class="ruby">    if dossier_eleve.present? &amp;&amp; (dossier_eleve.eleve.date_naiss == date_saisie)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="23">
          <span class="hits">42</span>
          
          <code class="ruby">      if dossier_eleve.etat == &#39;pas connecté&#39;</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="24">
          <span class="hits">19</span>
          
          <code class="ruby">        dossier_eleve.update(etat: &#39;connecté&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="26">
          <span class="hits">42</span>
          
          <code class="ruby">      session[:identifiant] = identifiant</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="27">
          <span class="hits">42</span>
          
          <code class="ruby">      if dossier_eleve.derniere_etape.present?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="28">
          <span class="hits">5</span>
          
          <code class="ruby">        redirect_to &quot;/#{dossier_eleve.derniere_etape}&quot;</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="29">
          <span class="hits">37</span>
          
          <code class="ruby">      elsif dossier_eleve.etape_la_plus_avancee.present?</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="30">
          <span class="hits">37</span>
          
          <code class="ruby">        redirect_to &quot;/#{dossier_eleve.etape_la_plus_avancee}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="32">
          
          
          <code class="ruby">        redirect_to &quot;accueil&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      # Emettre un message générique quelle que soit l&#39;erreur pour éviter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      # de &quot;fuiter&quot; de l&#39;information sur l&#39;existence ou non des identifiants</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="38">
          <span class="hits">2</span>
          
          <code class="ruby">      session[:message_erreur] = &quot;Nous n&#39;avons pas reconnu ces identifiants, merci de les vérifier.&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to &#39;/&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def accueil</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="44">
          <span class="hits">4</span>
          
          <code class="ruby">    eleve.dossier_eleve.update derniere_etape: &#39;accueil&#39;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    @dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def normalise_alphanum chaine</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="49">
          <span class="hits">44</span>
          
          <code class="ruby">    chaine.gsub(/[^[:alnum:]]/, &#39;&#39;).upcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_eleve</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="53">
          <span class="hits">12</span>
          
          <code class="ruby">    eleve.dossier_eleve.update derniere_etape: &#39;eleve&#39;</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="54">
          <span class="hits">12</span>
          
          <code class="ruby">    @options_du_niveau = eleve.montee.present? ? eleve.montee.demandabilite.collect(&amp;:option) : []</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="55">
          <span class="hits">12</span>
          
          <code class="ruby">    @eleve = eleve</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="56">
          <span class="hits">12</span>
          
          <code class="ruby">    render &#39;accueil/eleve&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_eleve</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="60">
          <span class="hits">13</span>
          
          <code class="ruby">    eleve_a_modifier = eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="62">
          <span class="hits">13</span>
          
          <code class="ruby">    identite_eleve = [&#39;prenom&#39;, &#39;prenom_2&#39;, &#39;prenom_3&#39;, &#39;nom&#39;, &#39;sexe&#39;, &#39;ville_naiss&#39;, &#39;pays_naiss&#39;, &#39;nationalite&#39;, &#39;classe_ant&#39;, &#39;ets_ant&#39;]</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="63">
          <span class="hits">13</span>
          
          <code class="ruby">    identite_eleve.each do |info|</code>
        </li>
      
        <li class="covered" data-hits="130" data-linenumber="64">
          <span class="hits">130</span>
          
          <code class="ruby">      eleve_a_modifier[info] = params[info] if params.has_key?(info)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="67">
          <span class="hits">13</span>
          
          <code class="ruby">    options = eleve.montee.present? ? eleve.montee.abandonnabilite.collect(&amp;:option) : []</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="68">
          <span class="hits">13</span>
          
          <code class="ruby">    options.each do |option|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">      if params[&quot;#{option.nom}_present&quot;]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">        abandon = Abandon.find_or_initialize_by(eleve: eleve, option: option)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="71">
          <span class="hits">2</span>
          
          <code class="ruby">        eleve_a_modifier.abandon.delete abandon if params[option.nom] == &#39;true&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="72">
          <span class="hits">2</span>
          
          <code class="ruby">        eleve_a_modifier.abandon &lt;&lt; abandon if params[option.nom].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="76">
          <span class="hits">13</span>
          
          <code class="ruby">    eleve_a_modifier.demande = []</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="77">
          <span class="hits">13</span>
          
          <code class="ruby">    options_demandees = eleve.montee.present? ? eleve.montee.demandabilite.collect(&amp;:option) : []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="79">
          <span class="hits">13</span>
          
          <code class="ruby">    options_demandees.each do |option|</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="80">
          <span class="hits">21</span>
          
          <code class="ruby">      if params[&quot;#{option.nom}_present&quot;]</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="81">
          <span class="hits">8</span>
          
          <code class="ruby">        demande = Demande.find_or_initialize_by(eleve: eleve, option: option)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="82">
          <span class="hits">8</span>
          
          <code class="ruby">        eleve_a_modifier.demande.delete demande if params[option.nom].nil?</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="83">
          <span class="hits">8</span>
          
          <code class="ruby">        eleve_a_modifier.demande &lt;&lt; demande if params[option.nom] == &#39;true&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="87">
          <span class="hits">13</span>
          
          <code class="ruby">    options_demandees.collect(&amp;:groupe).uniq.each do |groupe|</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="88">
          <span class="hits">12</span>
          
          <code class="ruby">      if params[groupe].present?</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="89">
          <span class="hits">11</span>
          
          <code class="ruby">        option_choisie = options_demandees.find {|option| option.nom == params[groupe]}</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="90">
          <span class="hits">4</span>
          
          <code class="ruby">        demande = Demande.find_or_initialize_by(eleve: eleve_a_modifier, option: option_choisie)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="91">
          <span class="hits">4</span>
          
          <code class="ruby">        eleve_a_modifier.demande &lt;&lt; demande</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="92">
          <span class="hits">4</span>
          
          <code class="ruby">        puts &quot;eleve_a_modifier.demande #{eleve_a_modifier.demande.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="96">
          <span class="hits">13</span>
          
          <code class="ruby">    eleve_a_modifier.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="98">
          <span class="hits">13</span>
          
          <code class="ruby">    puts &quot;eleve_a_modifier.demande #{eleve_a_modifier.demande.inspect}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="100">
          <span class="hits">13</span>
          
          <code class="ruby">    sauve_et_redirect eleve.dossier_eleve, &#39;famille&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_famille</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="104">
          <span class="hits">10</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="105">
          <span class="hits">10</span>
          
          <code class="ruby">    dossier_eleve.update derniere_etape: &#39;famille&#39;</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="106">
          <span class="hits">10</span>
          
          <code class="ruby">    resp_legal1 = dossier_eleve.resp_legal_1</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="107">
          <span class="hits">10</span>
          
          <code class="ruby">    resp_legal2 = dossier_eleve.resp_legal_2</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="108">
          <span class="hits">10</span>
          
          <code class="ruby">    contact_urgence = dossier_eleve.contact_urgence</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="109">
          <span class="hits">10</span>
          
          <code class="ruby">    contact_urgence = nil if contact_urgence.present? &amp;&amp; ! dossier_eleve.contact_urgence.nom.present?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="110">
          <span class="hits">10</span>
          
          <code class="ruby">    lien_de_parentes = [&#39;MERE&#39;, &#39;PERE&#39;, &#39;AUTRE FAM.&#39;, &#39;AUTRE LIEN&#39;, &#39;TUTEUR&#39;, &#39;ASE&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="112">
          <span class="hits">10</span>
          
          <code class="ruby">    @resp_legal_1 = resp_legal1</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="113">
          <span class="hits">10</span>
          
          <code class="ruby">    @resp_legal_2 = resp_legal2</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="114">
          <span class="hits">10</span>
          
          <code class="ruby">    @contact_urgence = contact_urgence</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="115">
          <span class="hits">10</span>
          
          <code class="ruby">    @code_profession = RespLegal.codes_profession</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="116">
          <span class="hits">10</span>
          
          <code class="ruby">    @code_situation = code_situation</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="117">
          <span class="hits">10</span>
          
          <code class="ruby">    @lien_de_parentes = lien_de_parentes</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="118">
          <span class="hits">10</span>
          
          <code class="ruby">    @dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="119">
          <span class="hits">10</span>
          
          <code class="ruby">    render &#39;accueil/famille&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_famille</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="123">
          <span class="hits">6</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="124">
          <span class="hits">6</span>
          
          <code class="ruby">    resp_legal1 = dossier_eleve.resp_legal_1</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="125">
          <span class="hits">6</span>
          
          <code class="ruby">    resp_legal2 = dossier_eleve.resp_legal_2</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="126">
          <span class="hits">6</span>
          
          <code class="ruby">    contact_urgence = ContactUrgence.find_by(dossier_eleve_id: dossier_eleve.id) || ContactUrgence.new(dossier_eleve_id: dossier_eleve.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="128">
          <span class="hits">6</span>
          
          <code class="ruby">    RespLegal.identites.each do |i|</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="129">
          <span class="hits">78</span>
          
          <code class="ruby">      resp_legal1[i] = params[&quot;#{i}_rl1&quot;] if params.has_key?(&quot;#{i}_rl1&quot;)</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="130">
          <span class="hits">78</span>
          
          <code class="ruby">      resp_legal2[i] = params[&quot;#{i}_rl2&quot;] if resp_legal2 &amp;&amp; params.has_key?(&quot;#{i}_rl2&quot;)</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="131">
          <span class="hits">78</span>
          
          <code class="ruby">      contact_urgence[i] = params[&quot;#{i}_urg&quot;] if params.has_key?(&quot;#{i}_urg&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="134">
          <span class="hits">6</span>
          
          <code class="ruby">    resp_legal1.save!</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="135">
          <span class="hits">6</span>
          
          <code class="ruby">    resp_legal2.save! if resp_legal2</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="136">
          <span class="hits">6</span>
          
          <code class="ruby">    contact_urgence.save!</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="137">
          <span class="hits">6</span>
          
          <code class="ruby">    sauve_et_redirect dossier_eleve, &#39;administration&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="140">
          <span class="hits">1</span>
          
          <code class="ruby">  def validation</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="141">
          <span class="hits">2</span>
          
          <code class="ruby">    render &#39;validation&#39;, locals: { eleve: eleve, dossier_eleve: eleve.dossier_eleve }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_validation</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="145">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="146">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve.signature = params[:signature]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="147">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve.date_signature = Time.now</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="148">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="149">
          <span class="hits">2</span>
          
          <code class="ruby">    if dossier_eleve.etat != &#39;validé&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="150">
          <span class="hits">2</span>
          
          <code class="ruby">      mail = AgentMailer.envoyer_mail_confirmation(dossier_eleve.eleve)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="151">
          <span class="hits">2</span>
          
          <code class="ruby">      mail.deliver_now</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="152">
          <span class="hits">2</span>
          
          <code class="ruby">      dossier_eleve.update(etat: &#39;en attente de validation&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="154">
          <span class="hits">2</span>
          
          <code class="ruby">    sauve_et_redirect dossier_eleve, &#39;confirmation&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_dossier_eleve identifiant</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="158">
          <span class="hits">44</span>
          
          <code class="ruby">    DossierEleve.joins(:eleve).find_by(eleves: {identifiant: identifiant})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">  def administration</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="162">
          <span class="hits">2</span>
          
          <code class="ruby">    eleve.dossier_eleve.update derniere_etape: &#39;administration&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="163">
          <span class="hits">2</span>
          
          <code class="ruby">    render &#39;administration&#39;, locals: {dossier_eleve: eleve.dossier_eleve}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="166">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_administration</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="167">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.demi_pensionnaire = params[&#39;demi_pensionnaire&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.autorise_sortie = params[&#39;autorise_sortie&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.renseignements_medicaux = params[&#39;renseignements_medicaux&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.check_paiement_cantine = params[&#39;check_paiement_cantine&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.save!</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="173">
          <span class="hits">1</span>
          
          <code class="ruby">    sauve_et_redirect dossier_eleve, &#39;pieces_a_joindre&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">  def deconnexion</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="177">
          <span class="hits">2</span>
          
          <code class="ruby">    reset_session</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="178">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to &#39;/&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="181">
          <span class="hits">1</span>
          
          <code class="ruby">  def confirmation</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="182">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="183">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve.update derniere_etape: &#39;confirmation&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="184">
          <span class="hits">2</span>
          
          <code class="ruby">    render &#39;confirmation&#39;, locals: { eleve: eleve, dossier_eleve: dossier_eleve }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">  def satisfaction</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="188">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.satisfaction = params[:note]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="193">
          <span class="hits">1</span>
          
          <code class="ruby">  def pieces_a_joindre</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="194">
          <span class="hits">3</span>
          
          <code class="ruby">    eleve.dossier_eleve.update derniere_etape: &#39;pieces_a_joindre&#39;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="195">
          <span class="hits">3</span>
          
          <code class="ruby">    render &#39;pieces_a_joindre&#39;, locals: {dossier_eleve: eleve.dossier_eleve}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">  def enregistre_piece_jointe</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="199">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">    upload_pieces_jointes dossier_eleve, params</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="201">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to &#39;/pieces_a_joindre&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">  def eleve</code>
        </li>
      
        <li class="covered" data-hits="245" data-linenumber="205">
          <span class="hits">245</span>
          
          <code class="ruby">    @eleve ||= Eleve.find_by(identifiant: session[:identifiant])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">  def code_situation</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="209">
          <span class="hits">10</span>
          
          <code class="ruby">    {&#39;0&#39;: &#39;&#39;, &#39;1&#39;: &#39;occupe un emploi&#39;, &#39;2&#39;: &#39;Au chômage&#39;, &#39;3&#39;: &#39;Pré retraité, retraité ou retiré&#39;, &#39;4&#39;: &#39;Personne sans activité professionnelle&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">  def sauve_et_redirect dossier_eleve, etape_la_plus_avancee</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="213">
          <span class="hits">22</span>
          
          <code class="ruby">    dossier_eleve.etape_la_plus_avancee = etape_la_plus_avancee</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="214">
          <span class="hits">22</span>
          
          <code class="ruby">    dossier_eleve.save!</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="215">
          <span class="hits">22</span>
          
          <code class="ruby">    redirect_to &quot;/#{etape_la_plus_avancee}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="216">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="217">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="218">
          <span class="hits">1</span>
          
          <code class="ruby">  def piece</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="219">
          
          
          <code class="ruby">    dossier_eleve = get_dossier_eleve params[:dossier_eleve]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">    # Vérifier les droits d&#39;accès</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="222">
          
          
          <code class="ruby">    famille_autorisé = params[:dossier_eleve] == session[:identifiant]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="224">
          
          
          <code class="ruby">    agent = Agent.find_by(identifiant: session[:identifiant])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="225">
          
          
          <code class="ruby">    agent_autorisé = agent.present? and (dossier_eleve.etablissement == agent.etablissement)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="226">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="227">
          
          
          <code class="ruby">    usager_autorisé = famille_autorisé || agent_autorisé</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="229">
          
          
          <code class="ruby">    objet_demandé = params[:s3_key]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="230">
          
          
          <code class="ruby">    objet_présent = PieceJointe.find_by(dossier_eleve_id: dossier_eleve.id, clef: params[:s3_key])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="231">
          
          
          <code class="ruby">    clef_objet_présent = objet_présent.clef if objet_présent.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="232">
          
          
          <code class="ruby">    objet_conforme = objet_demandé == clef_objet_présent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="234">
          
          
          <code class="ruby">    if usager_autorisé and objet_conforme</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="235">
          
          
          <code class="ruby">      extension = objet_présent.ext</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="236">
          
          
          <code class="ruby">      fichier = get_fichier_s3(objet_demandé)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="237">
          
          
          <code class="ruby">      if extension == &#39;pdf&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="238">
          
          
          <code class="ruby">        content_type &#39;application/pdf&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="239">
          
          
          <code class="ruby">      elsif extension == &#39;jpg&#39; or extension == &#39;jpeg&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="240">
          
          
          <code class="ruby">        content_type &#39;image/jpeg&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="241">
          
          
          <code class="ruby">      elsif extension == &#39;png&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="242">
          
          
          <code class="ruby">        content_type &#39;image/png&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="244">
          
          
          <code class="ruby">      send_data fichier.url(Time.now.to_i + 30)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">      redirect_to &#39;/&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="247">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">  def upload_pieces_jointes dossier_eleve, params, etat=&#39;soumis&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="251">
          <span class="hits">1</span>
          
          <code class="ruby">    params.each do |code, piece|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="252">
          <span class="hits">3</span>
          
          <code class="ruby">      if params[code].present? &amp;&amp; code != &quot;authenticity_token&quot; &amp;&amp; code != &quot;controller&quot; &amp;&amp; code != &quot;action&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="253">
          <span class="hits">1</span>
          
          <code class="ruby">        file = File.open(params[code].tempfile)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">        uploader = FichierUploader.new</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="255">
          <span class="hits">1</span>
          
          <code class="ruby">        uploader.store!(file)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="256">
          <span class="hits">1</span>
          
          <code class="ruby">        nom_du_fichier = File.basename(file.path)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="257">
          <span class="hits">1</span>
          
          <code class="ruby">        piece_attendue = PieceAttendue.find_by(code: code, etablissement_id: dossier_eleve.etablissement_id)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">        piece_jointe = PieceJointe.find_by(piece_attendue_id: piece_attendue.id, dossier_eleve_id: dossier_eleve.id)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="259">
          <span class="hits">1</span>
          
          <code class="ruby">        if piece_jointe.present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">          piece_jointe.update(etat: etat, clef: nom_du_fichier)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">          piece_jointe = PieceJointe.create!(etat: etat, clef: nom_du_fichier, piece_attendue_id: piece_attendue.id, dossier_eleve_id: dossier_eleve.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="263">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="266">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="267">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="268">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_pieces_a_joindre</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="269">
          
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="270">
          
          
          <code class="ruby">    pieces_attendues = dossier_eleve.etablissement.piece_attendue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">    pieces_obligatoires = false</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="272">
          
          
          <code class="ruby">    pieces_attendues.each do |piece|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="273">
          
          
          <code class="ruby">      piece_jointe = piece.piece_jointe</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="274">
          
          
          <code class="ruby">      if !piece_jointe.present? &amp;&amp; piece.obligatoire</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">        pieces_obligatoires = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="276">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="278">
          
          
          <code class="ruby">    if pieces_obligatoires</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="279">
          
          
          <code class="ruby">      erb :&#39;pieces_a_joindre&#39;, locals: {dossier_eleve: dossier_eleve, message: &#39;Veuillez télécharger les pièces obligatoires&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="280">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">      sauve_et_redirect dossier_eleve, &#39;validation&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="283">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="285">
          <span class="hits">1</span>
          
          <code class="ruby">  def commentaire</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="286">
          
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">    dossier_eleve.commentaire = params[:commentaire]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="288">
          
          
          <code class="ruby">    dossier_eleve.save!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="289">
          
          
          <code class="ruby">    head :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="291">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="292">
          <span class="hits">1</span>
          
          <code class="ruby">  def stats</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="293">
          <span class="hits">3</span>
          
          <code class="ruby">    etablissements = Etablissement.all.sort_by {|e| e.dossier_eleve.count}.reverse</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="294">
          <span class="hits">1</span>
          
          <code class="ruby">    render :stats, locals: {etablissements: etablissements}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="295">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="296">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="297">
          <span class="hits">1</span>
          
          <code class="ruby">  def verifie_identité</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="298">
          <span class="hits">61</span>
          
          <code class="ruby">    unless eleve</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="299">
          
          
          <code class="ruby">      session[:message_erreur] = &quot;Vous avez été déconnecté par mesure de sécurité. Merci de vous identifier avant de continuer.&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="300">
          
          
          <code class="ruby">      redirect_to &#39;/&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="67d8f4f56b98a41ec0384f715547f7e146b97d14">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="156d8b103c28ce8a4187d7b3a73a91998aad2d98">
  <div class="header">
    <h3>app/controllers/eleves_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>0</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="118ae267dcfd23628c5aafa07786ebb11f1d9917">
  <div class="header">
    <h3>app/controllers/inscriptions_controller.rb</h3>
    <h4><span class="red">72.82 %</span> covered</h4>
    <div>
      <b>195</b> relevant lines. 
      <span class="green"><b>142</b> lines covered</span> and
      <span class="red"><b>53</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;traitement&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class InscriptionsController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :identification, except: [:post_agent, :agent, :declenche_traiter_imports]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  layout &#39;layout_agent&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def agent</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    render :identification</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_agent</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="12">
          <span class="hits">40</span>
          
          <code class="ruby">    mon_agent = Agent.find_by(identifiant: params[:identifiant])</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="13">
          <span class="hits">40</span>
          
          <code class="ruby">    mdp_saisi = params[:mot_de_passe]</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="14">
          <span class="hits">40</span>
          
          <code class="ruby">    if mon_agent &amp;&amp; (BCrypt::Password.new(mon_agent.password) == mdp_saisi)</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="15">
          <span class="hits">38</span>
          
          <code class="ruby">      session[:identifiant] = mon_agent.identifiant</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="16">
          <span class="hits">38</span>
          
          <code class="ruby">      redirect_to &#39;/agent/liste_des_eleves&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="18">
          <span class="hits">2</span>
          
          <code class="ruby">      session[:erreur_login] = &quot;Ces informations ne correspondent pas à un agent enregistré&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">      redirect_to &#39;/agent&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def liste_des_eleves</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="24">
          <span class="hits">10</span>
          
          <code class="ruby">    lignes_eleves = DossierEleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      .joins(:eleve,:resp_legal)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      .select(&#39;dossier_eleves.id as dossier_id&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      .select(&#39;dossier_eleves.updated_at as dossier_maj&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      .select(&#39;dossier_eleves.*&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      .select(&#39;eleves.*&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      .select(&#39;resp_legals.email&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      .select(&#39;adresse,code_postal,ville,adresse_ant,code_postal_ant,ville_ant&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      .order(&#39;eleves.classe_ant DESC, dossier_eleves.etat, eleves.identifiant&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      .where(resp_legals:{priorite:1}, etablissement: get_agent.etablissement)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="34">
          <span class="hits">10</span>
          
          <code class="ruby">    pieces_jointes = PieceJointe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      .joins(:dossier_eleve,:piece_attendue)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      .select(&#39;dossier_eleves.id as dossier_id&#39;).select(&#39;piece_jointes.*&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      .where(piece_attendues:{etablissement_id: get_agent.etablissement.id})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      .group_by(&amp;:dossier_eleve_id)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="39">
          <span class="hits">10</span>
          
          <code class="ruby">    messages = Message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      .joins(:dossier_eleve)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      .select(&#39;dossier_eleves.id as dossier_id&#39;).select(&#39;messages.dossier_eleve_id&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      .where(dossier_eleves:{etablissement_id: get_agent.etablissement.id})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">      .group_by(&amp;:dossier_eleve_id)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="44">
          <span class="hits">10</span>
          
          <code class="ruby">    message_info = session[:message_info]</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="45">
          <span class="hits">10</span>
          
          <code class="ruby">    session.delete :message_info</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="46">
          <span class="hits">10</span>
          
          <code class="ruby">    render :liste_des_eleves,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      locals: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">        agent: get_agent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        lignes_eleves: lignes_eleves,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        message_info: message_info,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">        messages: messages,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">        pieces_attendues: get_agent.etablissement.piece_attendue,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">        pieces_jointes: pieces_jointes}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def import_siecle</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="57">
          <span class="hits">3</span>
          
          <code class="ruby">    tempfile = params[:filename].tempfile</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="58">
          <span class="hits">3</span>
          
          <code class="ruby">    tempfile = tempfile.path if tempfile.respond_to? :path</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="59">
          <span class="hits">3</span>
          
          <code class="ruby">    file = File.open(tempfile)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="60">
          <span class="hits">3</span>
          
          <code class="ruby">    uploader = FichierUploader.new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="61">
          <span class="hits">3</span>
          
          <code class="ruby">    uploader.store!(file)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="62">
          <span class="hits">3</span>
          
          <code class="ruby">    fichier_s3 = get_fichier_s3 File.basename(tempfile)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="63">
          <span class="hits">3</span>
          
          <code class="ruby">    tache = TacheImport.create(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">        url: fichier_s3.url(Time.now.to_i + 1200),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">        etablissement_id: get_agent.etablissement.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">        statut: &#39;en_attente&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        nom_a_importer: params[:nom_eleve],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">        prenom_a_importer: params[:prenom_eleve],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">        traitement: params[:traitement])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="70">
          <span class="hits">3</span>
          
          <code class="ruby">    render :import_siecle,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">        locals: { message: &quot;&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">                  tache: tache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">  def new_import_siecle</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="77">
          <span class="hits">2</span>
          
          <code class="ruby">    tache = get_agent.etablissement.tache_import.last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="78">
          <span class="hits">2</span>
          
          <code class="ruby">    render :import_siecle, locals: {agent: get_agent, tache: tache, message: &quot;&quot;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">  def declenche_traiter_imports</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="82">
          <span class="hits">7</span>
          
          <code class="ruby">    traiter_imports</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="83">
          <span class="hits">7</span>
          
          <code class="ruby">    head :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">  def change_etat_fichier</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    piece = PieceJointe.find(params[:id])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">    piece.update(etat: params[:etat])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">    head :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  def eleve</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="93">
          <span class="hits">12</span>
          
          <code class="ruby">    eleve = Eleve.find_by(identifiant: params[:identifiant])</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="94">
          <span class="hits">12</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="95">
          <span class="hits">12</span>
          
          <code class="ruby">    emails_presents = false</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="96">
          <span class="hits">12</span>
          
          <code class="ruby">    resp_legaux = dossier_eleve.resp_legal</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="97">
          <span class="hits">33</span>
          
          <code class="ruby">    resp_legaux.each { |r| (emails_presents = true) if r.email.present?}</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="98">
          <span class="hits">12</span>
          
          <code class="ruby">    meme_adresse = resp_legaux.first.meme_adresse resp_legaux.second</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="99">
          <span class="hits">12</span>
          
          <code class="ruby">    modeles = get_agent.etablissement.modele</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="100">
          <span class="hits">12</span>
          
          <code class="ruby">    render :eleve,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">      locals: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      emails_presents: emails_presents,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      agent: get_agent,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      modeles: modeles,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">      eleve: eleve,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">      dossier_eleve: dossier_eleve,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      meme_adresse: meme_adresse}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="110">
          <span class="hits">1</span>
          
          <code class="ruby">  def pieces_attendues</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="111">
          
          
          <code class="ruby">    etablissement = get_agent.etablissement</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="112">
          
          
          <code class="ruby">    piece_attendues = etablissement.piece_attendue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="113">
          
          
          <code class="ruby">    render :piece_attendues, locals: {agent: get_agent, piece_attendues: piece_attendues}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_pieces_attendues</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">    etablissement = get_agent.etablissement</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">    code_piece = params[:nom].gsub(/[^a-zA-Z0-9]/, &#39;_&#39;).upcase.downcase</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">    piece_attendue = PieceAttendue.find_by(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">        code: code_piece,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">        etablissement: etablissement.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="123">
          <span class="hits">1</span>
          
          <code class="ruby">    if !params[:nom].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="124">
          
          
          <code class="ruby">      message = &quot;Une pièce doit comporter un nom&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="125">
          
          
          <code class="ruby">      render :piece_attendues, locals: {piece_attendues: etablissement.piece_attendue, message: message}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="126">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif piece_attendue.present? &amp;&amp; (piece_attendue.nom == code_piece)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="127">
          
          
          <code class="ruby">      message = &quot;#{params[:nom]} existe déjà&quot;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="128">
          
          
          <code class="ruby">      render :piece_attendues, locals: {piece_attendues: etablissement.piece_attendue, message: message}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">      piece_attendue = PieceAttendue.create!(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">          nom: params[:nom],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">          explication: params[:explication],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">          obligatoire: params[:obligatoire],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">          etablissement_id: etablissement.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">          code: code_piece)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">      render :piece_attendues,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">          locals: {piece_attendues: etablissement.piece_attendue, agent: get_agent}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_pdf</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">    eleve = Eleve.find_by identifiant: params[:identifiant]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">    pdf = genere_pdf eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">    agent = Agent.find_by(identifiant: session[:identifiant])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    send_data pdf.render, type: &#39;application/pdf&#39;, disposition: &#39;inline&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">  def valider_inscription</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="149">
          <span class="hits">2</span>
          
          <code class="ruby">    eleve = Eleve.find_by identifiant: params[:identifiant]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="150">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="151">
          <span class="hits">6</span>
          
          <code class="ruby">    emails = dossier_eleve.resp_legal.map{ |resp_legal| resp_legal.email }</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="152">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve.valide</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="154">
          <span class="hits">2</span>
          
          <code class="ruby">    redirect_to &quot;/agent/liste_des_eleves&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def eleve_sortant</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="158">
          <span class="hits">1</span>
          
          <code class="ruby">    eleve = Eleve.find_by identifiant: params[:identifiant]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.update(etat: &#39;sortant&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="162">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to &quot;/agent/liste_des_eleves&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">  def contacter_une_famille</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="166">
          <span class="hits">6</span>
          
          <code class="ruby">    eleve = Eleve.find_by(identifiant: params[:identifiant])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="167">
          <span class="hits">6</span>
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="168">
          <span class="hits">6</span>
          
          <code class="ruby">    emails_presents = false</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="169">
          <span class="hits">6</span>
          
          <code class="ruby">    resp_legaux = dossier_eleve.resp_legal</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="170">
          <span class="hits">18</span>
          
          <code class="ruby">    resp_legaux.each { |r| (emails_presents = true) if r.email.present?}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="171">
          <span class="hits">6</span>
          
          <code class="ruby">    session[:message_info] = &quot;Votre message ne peut être acheminé.&quot;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="172">
          <span class="hits">6</span>
          
          <code class="ruby">    if emails_presents</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="173">
          <span class="hits">5</span>
          
          <code class="ruby">      mail = AgentMailer.contacter_une_famille(eleve, params[:message])</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="174">
          <span class="hits">5</span>
          
          <code class="ruby">      part = mail.html_part || mail.text_part || mail</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="175">
          <span class="hits">5</span>
          
          <code class="ruby">      Message.create(categorie:&quot;mail&quot;, contenu: part.body, etat: &quot;envoyé&quot;, dossier_eleve: eleve.dossier_eleve)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="176">
          <span class="hits">5</span>
          
          <code class="ruby">      mail.deliver_now</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="177">
          <span class="hits">5</span>
          
          <code class="ruby">      session[:message_info] = &quot;Votre message a été envoyé.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">    elsif dossier_eleve.portable_rl1.present?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">      Message.create(categorie:&quot;sms&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">                     contenu: params[:message],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">                     destinataire: params[:destinataire] || &quot;rl1&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">                     etat: &quot;en attente&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">                     dossier_eleve: eleve.dossier_eleve)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="184">
          <span class="hits">1</span>
          
          <code class="ruby">      session[:message_info] = &quot;Votre message est en attente d&#39;expédition.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="186">
          <span class="hits">6</span>
          
          <code class="ruby">    redirect_to &quot;/agent/liste_des_eleves&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="189">
          <span class="hits">1</span>
          
          <code class="ruby">  def relance_emails</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="190">
          <span class="hits">1</span>
          
          <code class="ruby">    template = params[:template]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="191">
          <span class="hits">1</span>
          
          <code class="ruby">    ids = params[:ids].split(&#39;,&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="192">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleves = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">    ids.each do |id|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="195">
          <span class="hits">1</span>
          
          <code class="ruby">      dossier = DossierEleve.find(id)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="196">
          <span class="hits">2</span>
          
          <code class="ruby">      template = Tilt[&#39;erb&#39;].new { template }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="197">
          <span class="hits">1</span>
          
          <code class="ruby">      contenu = template.render(nil, eleve: dossier.eleve)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="198">
          <span class="hits">1</span>
          
          <code class="ruby">      Message.create(categorie:&quot;mail&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">                     contenu: contenu,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                     etat: &quot;en attente&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">                     dossier_eleve: dossier)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to &#39;/agent/liste_des_eleves&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="207">
          <span class="hits">1</span>
          
          <code class="ruby">  def fusionne_modele</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="208">
          
          
          <code class="ruby">    eleve = Eleve.find_by(identifiant: params[:identifiant])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="209">
          
          
          <code class="ruby">    modele = Modele.find(params[:modele_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="210">
          
          
          <code class="ruby">    template = Tilt[&#39;erb&#39;].new { modele.contenu }</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="211">
          
          
          <code class="ruby">    template.render(nil, eleve: eleve)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">  def valider_plusieurs_dossiers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">    ids = params[&quot;ids&quot;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="216">
          <span class="hits">1</span>
          
          <code class="ruby">    ids.each do |id|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="217">
          <span class="hits">2</span>
          
          <code class="ruby">      DossierEleve.find(id).valide</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="218">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="219">
          <span class="hits">1</span>
          
          <code class="ruby">    redirect_to &#39;/agent/liste_des_eleves&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="222">
          <span class="hits">1</span>
          
          <code class="ruby">  def options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="223">
          <span class="hits">1</span>
          
          <code class="ruby">    etablissement = get_agent.etablissement</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="224">
          <span class="hits">1</span>
          
          <code class="ruby">    eleves_par_classe = DossierEleve.where(etablissement_id: etablissement.id).collect(&amp;:eleve).group_by(&amp;:niveau_classe_ant)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="225">
          <span class="hits">8</span>
          
          <code class="ruby">    eleves = Eleve.all.select {|e| e.dossier_eleve.etablissement_id == etablissement.id &amp;&amp; e.dossier_eleve.etat != &#39;sortant&#39;}</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">    nb_max_options = 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="227">
          <span class="hits">1</span>
          
          <code class="ruby">    eleves.each do |e|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="228">
          <span class="hits">4</span>
          
          <code class="ruby">      nb_max_options = e.options_apres_montee.count if e.options_apres_montee.count &gt; nb_max_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="230">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="231">
          <span class="hits">1</span>
          
          <code class="ruby">    render :options, locals: {agent: get_agent,etablissement: etablissement, eleves_par_classe: eleves_par_classe,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">                                   eleves: eleves, nb_max_options: nb_max_options}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="235">
          <span class="hits">1</span>
          
          <code class="ruby">  def convocations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="236">
          <span class="hits">1</span>
          
          <code class="ruby">    etablissement = get_agent.etablissement</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="237">
          <span class="hits">1</span>
          
          <code class="ruby">    eleves = Eleve.all.select do |e|</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="238">
          <span class="hits">7</span>
          
          <code class="ruby">      d = e.dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="239">
          <span class="hits">7</span>
          
          <code class="ruby">      d.etablissement_id == etablissement.id &amp;&amp; (d.etat == &#39;pas connecté&#39; || d.etat == &#39;connecté&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">    render :convocations, locals: {agent: get_agent,etablissement: etablissement, eleves: eleves}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="245">
          <span class="hits">1</span>
          
          <code class="ruby">  def deconnexion</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="246">
          
          
          <code class="ruby">    reset_session</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="247">
          
          
          <code class="ruby">    redirect_to &#39;/agent&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">  def tableau_de_bord</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="251">
          
          
          <code class="ruby">    total_dossiers = get_agent.etablissement.dossier_eleve.count</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="252">
          
          
          <code class="ruby">    etats, notes, moyenne, dossiers_avec_commentaires = get_agent.etablissement.stats</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="253">
          
          
          <code class="ruby">    render :tableau_de_bord,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="254">
          
          
          <code class="ruby">        locals: {agent: get_agent, total_dossiers: total_dossiers, etats: etats,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="255">
          
          
          <code class="ruby">                 notes: notes, moyenne: moyenne, dossiers_avec_commentaires: dossiers_avec_commentaires.sort_by(&amp;:date_signature).reverse}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_tableau_de_bord</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="259">
          
          
          <code class="ruby">    get_agent.update(etablissement_id: params[:etablissement])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="260">
          
          
          <code class="ruby">    redirect_to &#39;/agent/tableau_de_bord&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="262">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="263">
          <span class="hits">1</span>
          
          <code class="ruby">  def pieces_jointes_eleve</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="264">
          
          
          <code class="ruby">    eleve = Eleve.find_by(identifiant: params[:identifiant])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="265">
          
          
          <code class="ruby">    dossier_eleve = eleve.dossier_eleve</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="266">
          
          
          <code class="ruby">    upload_pieces_jointes dossier_eleve, params, &#39;valide&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="267">
          
          
          <code class="ruby">    redirect_to &quot;/agent/eleve/#{eleve.identifiant}#dossier&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="270">
          <span class="hits">1</span>
          
          <code class="ruby">  def export</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="271">
          
          
          <code class="ruby">    render :export, locals: {agent: get_agent}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="272">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="274">
          <span class="hits">1</span>
          
          <code class="ruby">  def supprime_option</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="275">
          
          
          <code class="ruby">    Option.find(params[:option_id]).delete</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="276">
          
          
          <code class="ruby">    head ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">  def supprime_piece_attendue</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="280">
          
          
          <code class="ruby">    pieces_existantes = PieceJointe.where(piece_attendue_id: params[:piece_attendue_id])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="281">
          
          
          <code class="ruby">    if pieces_existantes.size &gt;= 1</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="282">
          
          
          <code class="ruby">      message = &#39;Cette piece ne peut être supprimé&#39;</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="283">
          
          
          <code class="ruby">      raise</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="284">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="285">
          
          
          <code class="ruby">      PieceAttendue.find(params[:piece_attendue_id]).delete</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="287">
          
          
          <code class="ruby">    head :ok</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="288">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="290">
          <span class="hits">1</span>
          
          <code class="ruby">  def relance</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="291">
          
          
          <code class="ruby">    ids = params[&quot;ids&quot;].split(&#39;,&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="292">
          
          
          <code class="ruby">    emails, telephones  = [], []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="294">
          
          
          <code class="ruby">    ids.each do |id|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="295">
          
          
          <code class="ruby">      dossier = DossierEleve.find(id)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="296">
          
          
          <code class="ruby">      emails &lt;&lt; dossier.resp_legal_1.email</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="297">
          
          
          <code class="ruby">      telephones &lt;&lt; dossier.portable_rl1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="299">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="300">
          
          
          <code class="ruby">    render :relance,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">        locals: {ids: ids, emails: emails, telephones: telephones}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="303">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="304">
          <span class="hits">1</span>
          
          <code class="ruby">  def relance_sms</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="305">
          
          
          <code class="ruby">    template = params[:template]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="306">
          
          
          <code class="ruby">    ids = params[:ids].split(&#39;,&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="307">
          
          
          <code class="ruby">    ids.each do |id|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="308">
          
          
          <code class="ruby">      DossierEleve.find(id).relance_sms template</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="310">
          
          
          <code class="ruby">    redirect_to &#39;/agent/liste_des_eleves&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="311">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="312">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="313">
          <span class="hits">1</span>
          
          <code class="ruby">  def creer_etablissement</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="314">
          
          
          <code class="ruby">    redirect_to &#39;/agent&#39; unless get_agent.admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="315">
          
          
          <code class="ruby">    render :creer_etablissement</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="316">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="317">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="318">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_creer_etablissement</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="319">
          
          
          <code class="ruby">    Etablissement.create!(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="321">
          
          
          <code class="ruby">    redirect_to :creer_agent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">  def creer_agent</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="325">
          
          
          <code class="ruby">    redirect_to &#39;/agent&#39; unless get_agent.admin</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="326">
          
          
          <code class="ruby">    render :creer_agent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="328">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="329">
          <span class="hits">1</span>
          
          <code class="ruby">  def post_creer_agent</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="330">
          
          
          <code class="ruby">    a = Agent.create!(params)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="331">
          
          
          <code class="ruby">    a.password = BCrypt::Password.create(params[:password])</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="332">
          
          
          <code class="ruby">    a.save!</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="333">
          
          
          <code class="ruby">    redirect_to &quot;/agent/liste_des_eleves&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="334">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="335">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="336">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="337">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_agent</code>
        </li>
      
        <li class="covered" data-hits="131" data-linenumber="338">
          <span class="hits">131</span>
          
          <code class="ruby">    @agent ||= Agent.find_by(identifiant: session[:identifiant])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="339">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="340">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="341">
          <span class="hits">1</span>
          
          <code class="ruby">  def identification</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="342">
          <span class="hits">44</span>
          
          <code class="ruby">    agent_connecte = get_agent</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="343">
          <span class="hits">44</span>
          
          <code class="ruby">    identifiant = agent_connecte.present? ? agent_connecte.identifiant : &#39;&lt;anonyme&gt;&#39;</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="344">
          <span class="hits">44</span>
          
          <code class="ruby">    Trace.create(identifiant: identifiant,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby">                 categorie: &#39;agent&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="346">
          
          
          <code class="ruby">                 page_demandee: request.path_info,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby">                 adresse_ip: request.ip)</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="348">
          <span class="hits">44</span>
          
          <code class="ruby">    redirect_to &#39;/agent&#39; unless agent_connecte.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="349">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="350">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d9bb6ae4328bef863171723d65f913f9c3803bfe">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ApplicationHelper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def construire champs</code>
        </li>
      
        <li class="covered" data-hits="147" data-linenumber="3">
          <span class="hits">147</span>
          
          <code class="ruby">    champs.map do |champ|</code>
        </li>
      
        <li class="covered" data-hits="590" data-linenumber="4">
          <span class="hits">590</span>
          
          <code class="ruby">      render partial: &#39;partials/champ&#39;, locals: champ</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end.join</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ea2c786176cae412887a725747f7e6c862cf5be0">
  <div class="header">
    <h3>app/jobs/application_job.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ApplicationJob &lt; ActiveJob::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8b94d0b74b29d3c2848996939cc2960327cd34f1">
  <div class="header">
    <h3>app/mailers/agent_mailer.rb</h3>
    <h4><span class="yellow">82.61 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class AgentMailer &lt; ApplicationMailer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">    default from: &quot;contact@dossiersco.beta.gouv.fr&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def emails</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="5">
          <span class="hits">29</span>
          
          <code class="ruby">        @eleve.dossier_eleve.resp_legal.map{ |resp_legal| resp_legal.email } +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">            [&#39;contact@dossiersco.beta.gouv.fr&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def contacter_une_famille(eleve, message)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="10">
          <span class="hits">11</span>
          
          <code class="ruby">        @message = message</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="11">
          <span class="hits">11</span>
          
          <code class="ruby">        @eleve = eleve</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="12">
          <span class="hits">11</span>
          
          <code class="ruby">        mail(subject: &quot;Réinscription de votre enfant au collège&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">            reply_to: [&#39;contact@dossiersco.beta.gouv.fr&#39;, @eleve.dossier_eleve.etablissement.email],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">            delivery_method_options: { api_key: ENV[&#39;MAILER_API_KEY&#39;], secret_key: ENV[&#39;MAILER_SECRET_KEY&#39;] },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">            to: emails) do |format|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="16">
          <span class="hits">11</span>
          
          <code class="ruby">                format.text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    def envoyer_mail_confirmation(eleve)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">        contacter_une_famille eleve, &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    def mail_validation_inscription(eleve)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="25">
          <span class="hits">4</span>
          
          <code class="ruby">        contacter_une_famille eleve, &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    def message_differe(eleve, contenu)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">        etablissement = eleve.dossier_eleve.etablissement</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">        resp_legal = eleve.dossier_eleve.resp_legal_1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">        mail(subject: &quot;Réinscription de votre enfant au collège&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">            reply_to:[&#39;contact@dossiersco.beta.gouv.fr&#39;, etablissement.email],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">            delivery_method_options: { api_key: ENV[&#39;MAILER_API_KEY&#39;], secret_key: ENV[&#39;MAILER_SECRET_KEY&#39;] },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">            to: [&#39;contact@dossiersco.beta.gouv.fr&#39;, resp_legal.email, etablissement.email]) do |format|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">                format.text { render plain: contenu }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    # Utilisée ponctuellement en juin 2018 pour &quot;doubler&quot; une diffusion par cartable</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    # d&#39;un contact mail, restreint au 1er RL car nous donnons l&#39;INE et contacter les 2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    # parents n&#39;aurait pas les mêmes caractéristiques que la diffusion par cartable du</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # point de vue sécurité; ne met pas l&#39;établissement en copie pour ne pas les spammer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    def invitations_parents(eleve)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="44">
          
          
          <code class="ruby">        @eleve = eleve</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="45">
          
          
          <code class="ruby">        destinataires = [eleve.dossier_eleve.resp_legal.first.email, &#39;contact@dossiersco.beta.gouv.fr&#39;]</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="46">
          
          
          <code class="ruby">        mail(subject: &quot;Réinscription de votre enfant au collège&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">            reply_to: [&#39;contact@dossiersco.beta.gouv.fr&#39;, @eleve.dossier_eleve.etablissement.email],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">            delivery_method_options: { api_key: ENV[&#39;MAILER_API_KEY&#39;], secret_key: ENV[&#39;MAILER_SECRET_KEY&#39;] },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">            to: destinataires) do |format|</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="50">
          
          
          <code class="ruby">                format.text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="db1bc6aef95690a1f3b4d378c7f61adc8b8d50a4">
  <div class="header">
    <h3>app/mailers/application_mailer.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationMailer &lt; ActionMailer::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  default from: &#39;from@example.com&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  layout &#39;mailer&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4ecc8f2960750c6d9cb852c10ddd850521a4dddf">
  <div class="header">
    <h3>app/models/abandon.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Abandon &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="06939284f208bc46f9485d7170475d6a2200e19e">
  <div class="header">
    <h3>app/models/abandonnabilite.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Abandonnabilite &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :montee</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="991bc9f53bf44164fb8ae2b04678a74083f06570">
  <div class="header">
    <h3>app/models/agent.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Agent &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :etablissement</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2c5f70c0710b67d4338de4845d83cd2187f429f2">
  <div class="header">
    <h3>app/models/application_record.rb</h3>
    <h4><span class="red">0.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="missed" data-hits="0" data-linenumber="1">
          
          
          <code class="ruby">class ApplicationRecord &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="2">
          
          
          <code class="ruby">  self.abstract_class = true</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="3">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d5690fbe0b3b04eff5b766cf59517ff78e353ccb">
  <div class="header">
    <h3>app/models/contact_urgence.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ContactUrgence &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :dossier_eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0e16b34ca223206b7f6e797877d00ebc95d7fbf8">
  <div class="header">
    <h3>app/models/demandabilite.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Demandabilite &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :montee</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="5e139ec46f25245b704b894869cae4204dfb1385">
  <div class="header">
    <h3>app/models/demande.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Demande &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cdf636f0633a00a046af3758191c95c07b4ddcb8">
  <div class="header">
    <h3>app/models/dossier_eleve.rb</h3>
    <h4><span class="green">92.68 %</span> covered</h4>
    <div>
      <b>41</b> relevant lines. 
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;uri&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;net/http&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;net/https&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;tilt/erb&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">class DossierEleve &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :etablissement</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :resp_legal</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :contact_urgence</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :piece_jointe</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def resp_legal_1</code>
        </li>
      
        <li class="covered" data-hits="111" data-linenumber="16">
          <span class="hits">111</span>
          
          <code class="ruby">    self.resp_legal.find {|r| r.priorite == 1}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def resp_legal_2</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="20">
          <span class="hits">73</span>
          
          <code class="ruby">    self.resp_legal.find {|r| r.priorite == 2}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def allocataire</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    enfants = self.resp_legal.first.enfants_a_charge || 0</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    enfants &gt; 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  DEFAULT_TEMPLATE = &quot;&lt;%= eleve.dossier_eleve.etablissement.nom %&gt;: attention, derniers jours pour réinscrire votre enfant &lt;%= eleve.prenom %&gt; sur https://dossiersco.fr avec vos identifiants: &lt;%= eleve.identifiant %&gt; et la date de naissance de l&#39;enfant.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def relance_sms template = DEFAULT_TEMPLATE</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    # Construction du message</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="32">
          <span class="hits">2</span>
          
          <code class="ruby">    template = Tilt[&#39;erb&#39;].new { template }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    text = template.render(nil,eleve: eleve)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    Message.create(categorie:&quot;sms&quot;, contenu: text, etat: &quot;en attente&quot;, dossier_eleve: self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def portable_present</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="39">
          
          
          <code class="ruby">    portable_rl1.present? || portable_rl2.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def portable_rl1</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="43">
          <span class="hits">9</span>
          
          <code class="ruby">    portable resp_legal_1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def portable_rl2</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="47">
          <span class="hits">3</span>
          
          <code class="ruby">    portable resp_legal_2 if resp_legal_2</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def portable rl</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="51">
          <span class="hits">11</span>
          
          <code class="ruby">    secondaire = rl.tel_secondaire</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="52">
          <span class="hits">11</span>
          
          <code class="ruby">    return secondaire unless (secondaire.blank? || secondaire.start_with?(&quot;01&quot;))</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="53">
          <span class="hits">3</span>
          
          <code class="ruby">    return rl.tel_principal</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def date_signature_gmt_plus_2</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="57">
          <span class="hits">3</span>
          
          <code class="ruby">    return &quot;&quot; unless self.date_signature</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">    self.date_signature.localtime(&quot;+02:00&quot;).strftime &quot;%d/%m à %H:%M&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  def valide</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="62">
          <span class="hits">4</span>
          
          <code class="ruby">    update(etat: &#39;validé&#39;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="63">
          <span class="hits">4</span>
          
          <code class="ruby">    mail = AgentMailer.mail_validation_inscription(eleve)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">    mail.deliver_now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c9fc941cca82df9e2f27af57b3128db123959aa0">
  <div class="header">
    <h3>app/models/eleve.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>53</b> relevant lines. 
      <span class="green"><b>53</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Eleve &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :option</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :demande</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :abandon</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :montee, required: false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def genere_demandes_possibles</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="9">
          <span class="hits">14</span>
          
          <code class="ruby">    return unless self.montee.present?</code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="10">
          <span class="hits">33</span>
          
          <code class="ruby">    options = self.montee.demandabilite.map { |d| d.option }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="33" data-linenumber="12">
          <span class="hits">33</span>
          
          <code class="ruby">    options_par_groupe = options.group_by {|o| o.groupe}</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="13">
          <span class="hits">14</span>
          
          <code class="ruby">    groupes_obligatoires = []</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="14">
          <span class="hits">14</span>
          
          <code class="ruby">    groupes_facultatives = []</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="15">
          <span class="hits">14</span>
          
          <code class="ruby">    groupes_obligatoires_sans_choix = []</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="16">
          <span class="hits">14</span>
          
          <code class="ruby">    options_par_groupe.each do |groupe, options|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="17">
          <span class="hits">14</span>
          
          <code class="ruby">      if options.first.modalite == &#39;obligatoire&#39;</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="18">
          <span class="hits">7</span>
          
          <code class="ruby">        if options.size == 1</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">          groupes_obligatoires_sans_choix &lt;&lt; options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="21">
          <span class="hits">3</span>
          
          <code class="ruby">          groupes_obligatoires &lt;&lt; options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="23">
          <span class="hits">7</span>
          
          <code class="ruby">      elsif options.first.modalite == &#39;facultative&#39;</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="24">
          <span class="hits">7</span>
          
          <code class="ruby">        groupes_facultatives &lt;&lt; options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="27">
          <span class="hits">14</span>
          
          <code class="ruby">    obligatoire(groupes_obligatoires) + facultative(groupes_facultatives) + obligatoire_sans_choix(groupes_obligatoires_sans_choix)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def obligatoire options_du_groupe</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="31">
          <span class="hits">14</span>
          
          <code class="ruby">    options_du_groupe.map do |options|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">      noms_options_du_groupe = options.collect(&amp;:nom)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">      noms_demandes = self.demande.map(&amp;:option).map(&amp;:nom)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">      options_du_groupe_demandees = noms_demandes &amp; noms_options_du_groupe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="36">
          <span class="hits">3</span>
          
          <code class="ruby">        label: options.first.groupe,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        name: options.first.groupe,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        type: &#39;radio&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">        options: options.collect(&amp;:nom),</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="40">
          <span class="hits">3</span>
          
          <code class="ruby">        checked: options_du_groupe_demandees.size == 1 ? options_du_groupe_demandees[0] : &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def options_demandees</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="46">
          <span class="hits">9</span>
          
          <code class="ruby">    self.demande.map(&amp;:option)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def options_abandonnees</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="50">
          <span class="hits">7</span>
          
          <code class="ruby">    self.abandon.map(&amp;:option)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def facultative options_du_groupe</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="54">
          <span class="hits">14</span>
          
          <code class="ruby">    options_du_groupe.flat_map do |options|</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="55">
          <span class="hits">7</span>
          
          <code class="ruby">      options.map do |option|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">        {</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="57">
          <span class="hits">9</span>
          
          <code class="ruby">          name: option.nom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">          label: option.groupe,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">          type: &quot;check&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">          condition: options_demandees.include?(option),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">          desc: option.nom_et_info</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def obligatoire_sans_choix options_du_groupe</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="68">
          <span class="hits">14</span>
          
          <code class="ruby">    options_du_groupe.map do |options|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="70">
          <span class="hits">4</span>
          
          <code class="ruby">        name: options.first.nom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">        label: options.first.groupe,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        type: &quot;hidden&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def genere_abandons_possibles</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="78">
          <span class="hits">9</span>
          
          <code class="ruby">    return unless self.montee.present?</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="79">
          <span class="hits">16</span>
          
          <code class="ruby">    noms_options = self.option.map { |o| o.nom }</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="80">
          <span class="hits">23</span>
          
          <code class="ruby">    options = self.montee.abandonnabilite.map { |d| d.option }.select { |o| noms_options.include? o.nom }</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="81">
          <span class="hits">9</span>
          
          <code class="ruby">    options.map do |option|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="83">
          <span class="hits">7</span>
          
          <code class="ruby">        name: option.nom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">        label: &quot;Poursuivre l&#39;option&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">        type: &quot;check&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">        condition: !options_abandonnees.include?(option),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">        desc: option.nom_et_info</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">  def options_apres_montee</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="93">
          <span class="hits">11</span>
          
          <code class="ruby">    options = []</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="94">
          <span class="hits">25</span>
          
          <code class="ruby">    options += self.option.map(&amp;:nom).select {|o| o}</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="95">
          <span class="hits">11</span>
          
          <code class="ruby">    options += self.demande.map(&amp;:option).map(&amp;:nom)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="96">
          <span class="hits">11</span>
          
          <code class="ruby">    (0...options.length).each do |i|</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="97">
          <span class="hits">15</span>
          
          <code class="ruby">      options[i] += &quot; (-)&quot; if self.abandon.map(&amp;:option).map(&amp;:nom).include? options[i]</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="98">
          <span class="hits">15</span>
          
          <code class="ruby">      options[i] += &quot; (+)&quot; if self.demande.map(&amp;:option).map(&amp;:nom).include? options[i]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="100">
          <span class="hits">11</span>
          
          <code class="ruby">    options.uniq.sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="af87c13869d589b070189a4981258658d368953f">
  <div class="header">
    <h3>app/models/etablissement.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Etablissement &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :agent</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :tache_import</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :piece_attendue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :modele</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def classes</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">    dossier_eleve.collect(&amp;:eleve).collect(&amp;:classe_ant).reject(&amp;:nil?).uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def niveaux</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    dossier_eleve.collect(&amp;:eleve).collect(&amp;:niveau_classe_ant).reject(&amp;:nil?).uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def stats</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="17">
          <span class="hits">6</span>
          
          <code class="ruby">    avec_feedback = []</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="18">
          <span class="hits">6</span>
          
          <code class="ruby">    etats = {}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="19">
          <span class="hits">6</span>
          
          <code class="ruby">    DossierEleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        .where.not(etat: &quot;pas connecté&quot;)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="21">
          <span class="hits">18</span>
          
          <code class="ruby">        .select { |e| e.etablissement_id == self.id }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        .group_by(&amp;:etat)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">        .each_pair do |etat, dossiers_etat|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="24">
          <span class="hits">9</span>
          
          <code class="ruby">            etats[etat] = dossiers_etat.count</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="25">
          <span class="hits">9</span>
          
          <code class="ruby">            if (etat.include? &quot;valid&quot;)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="26">
          <span class="hits">6</span>
          
          <code class="ruby">                avec_feedback.push(*dossiers_etat)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="29">
          <span class="hits">6</span>
          
          <code class="ruby">    notes = avec_feedback.collect(&amp;:satisfaction)</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="30">
          <span class="hits">12</span>
          
          <code class="ruby">    notes_renseignees = notes.select {|n| n &gt; 0}</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="31">
          <span class="hits">6</span>
          
          <code class="ruby">    moyenne = notes_renseignees.count &gt; 0 ? &quot;#{&#39;%.2f&#39; % ((notes_renseignees.sum+0.0)/notes_renseignees.count)}&quot; : &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="32">
          <span class="hits">12</span>
          
          <code class="ruby">    dossiers_avec_commentaires = avec_feedback.reject{ |d| d if d.commentaire.nil? || d.commentaire.empty? }</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="33">
          <span class="hits">6</span>
          
          <code class="ruby">    return etats, notes, moyenne, dossiers_avec_commentaires</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fe6f6c5cc0136098f7e664b99d4188fef49b0d72">
  <div class="header">
    <h3>app/models/message.rb</h3>
    <h4><span class="green">95.83 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Message &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :dossier_eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def envoyer</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    case self.categorie</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    when &quot;mail&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      AgentMailer.message_differe(dossier_eleve.eleve, contenu).deliver_now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    when &quot;sms&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      envoyer_sms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def numero</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">    destinataire == &quot;rl2&quot; ? dossier_eleve.portable_rl2 : dossier_eleve.portable_rl1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def envoyer_sms</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    if numero</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      numero_prefixe = numero.gsub(/[[:space:]]/,&#39;&#39;).gsub(/^0/,&#39;+33&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      uri = URI.parse(&quot;https://rest.nexmo.com/sms/json&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      https = Net::HTTP.new(uri.host,uri.port)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">      https.use_ssl = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">      header = {&#39;Content-Type&#39;: &#39;application/json&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      payload = {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">        &#39;api_key&#39;:&quot;#{ENV[&#39;NEXMO_KEY&#39;]}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        &#39;api_secret&#39;:&quot;#{ENV[&#39;NEXMO_SECRET&#39;]}&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        &#39;from&#39;: ENV[&#39;NEXMO_SENDER&#39;], &#39;to&#39;: numero_prefixe, &#39;text&#39;: contenu}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">      request = Net::HTTP::Post.new(uri.request_uri, header)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      request.body = payload.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      response = https.request(request)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      resultat = JSON.parse(response.body)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">      etat = resultat[&quot;messages&quot;].any? {|m| m[&quot;status&quot;].to_s != &quot;0&quot;} ? &quot;erreur&quot; : &quot;envoyé&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      update(resultat: response.body, etat:etat)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      sleep(2) unless ENV[&#39;rack_env&#39;] == &quot;test&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="42">
          
          
          <code class="ruby">      update(resultat: &quot;Pas de numéro&quot;, etat:&quot;abandon&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b688569f24114184179379e577583f2b1d48c7b0">
  <div class="header">
    <h3>app/models/modele.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>2</b> relevant lines. 
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Modele &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">	belongs_to  :etablissement</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3ae319a27d860cd3f30ad8abbd0ca4f3a2622e75">
  <div class="header">
    <h3>app/models/montee.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Montee &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">   has_many :demandabilite</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">   has_many :abandonnabilite</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c0b15737d76f53447c191b74aaa5b36cc783b1a8">
  <div class="header">
    <h3>app/models/option.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Option &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  has_and_belongs_to_many :eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def nom_et_info</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="4">
          <span class="hits">16</span>
          
          <code class="ruby">    self.nom + (self.info.present? ? &quot; #{self.info}&quot; : &quot;&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fe8ad0d27a7a60e38c56a47c3cef7ca7bd5ff0f4">
  <div class="header">
    <h3>app/models/piece_attendue.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PieceAttendue &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :etablissement</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :piece_jointe, dependent: :destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="007448c5efd98fbe4d9cf530a2900e301c0ff1c6">
  <div class="header">
    <h3>app/models/piece_jointe.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class PieceJointe &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :dossier_eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :piece_attendue</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def ext</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="6">
          <span class="hits">5</span>
          
          <code class="ruby">    self.clef.match(/(\w+$)/im)[1].downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dc8550cd58aec5d55149b7e2d92685b23c171aee">
  <div class="header">
    <h3>app/models/resp_legal.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RespLegal &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :dossier_eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def meme_adresse autre_resp_legal</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="5">
          <span class="hits">18</span>
          
          <code class="ruby">    return false if autre_resp_legal.nil?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="6">
          <span class="hits">14</span>
          
          <code class="ruby">    meme_adresse = true</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="7">
          <span class="hits">14</span>
          
          <code class="ruby">    [&quot;adresse&quot;, &quot;code_postal&quot;, &quot;ville&quot;].each do |c|</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="8">
          <span class="hits">42</span>
          
          <code class="ruby">      meme_adresse = meme_adresse &amp;&amp; (self[c] == autre_resp_legal[c])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="10">
          <span class="hits">14</span>
          
          <code class="ruby">    meme_adresse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def equivalentes(valeur1, valeur2)</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="14">
          <span class="hits">192</span>
          
          <code class="ruby">    (valeur1 &amp;&amp; valeur1.upcase.gsub(/[[:space:]]/,&#39;&#39;)) ==</code>
        </li>
      
        <li class="covered" data-hits="192" data-linenumber="15">
          <span class="hits">192</span>
          
          <code class="ruby">    (valeur2 &amp;&amp; valeur2.upcase.gsub(/[[:space:]]/,&#39;&#39;))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def changement_adresse</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="19">
          <span class="hits">64</span>
          
          <code class="ruby">    !adresse_inchangee</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def adresse_inchangee</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="23">
          <span class="hits">66</span>
          
          <code class="ruby">    equivalentes(adresse, adresse_ant) &amp;&amp;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    equivalentes(ville, ville_ant) &amp;&amp;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    equivalentes(code_postal, code_postal_ant)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.codes_profession</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="29">
          <span class="hits">10</span>
          
          <code class="ruby">    { &#39;99&#39;: &#39;&#39;, &#39;10&#39;: &#39;agriculteur exploitant&#39;, &#39;21&#39;: &#39;artisan&#39;, &#39;22&#39;: &#39;commerçant et assimilé&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">    &#39;23&#39;: &quot;chef d&#39;entreprise de 10 salariés et+&quot;, &#39;31&#39;: &#39;profession libérale&#39;, &#39;33&#39;: &#39;cadre de la fonction publique&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    &#39;34&#39;: &#39;professeur, profession scientifique&#39;, &#39;35&#39;: &quot;profession de l&#39;information, des arts et des spectacles&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    &#39;37&#39;: &quot;cadre administratif, commercial d&#39;entreprise&quot;, &#39;38&#39;: &quot;ingénieur, cadre technique d&#39;entreprise&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    &#39;42&#39;: &quot;instituteur et assimilé&quot;, &#39;43&#39;: &quot;profession intermédiaire de la santé et du travail social&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    &#39;44&#39;: &#39;Clergé, religieux&#39;, &#39;45&#39;: &quot;Profession intermédiaire administrative de la fonction publique&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    &#39;46&#39;: &quot;Profession intermédiaire administrative et commerciale des entreprises&quot;, &#39;47&#39;: &quot;Technicien&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    &#39;48&#39;: &quot;Contremaître, agent de maîtrise&quot;, &#39;52&#39;: &quot;Employé civil et agent de service de la fonction publique&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    &#39;53&#39;: &#39;Policier, militaire&#39;, &#39;54&#39;: &quot;Employé administratif d&#39;entreprise&quot;, &#39;55&#39;: &quot;Employé de commerce&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    &#39;56&#39;: &quot;Personnel service direct aux particuliers&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    &#39;62&#39;: &quot;Ouvrier qualifié - industrie&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    &#39;63&#39;: &quot;Ouvrier qualifié - artisanal&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    &#39;65&#39;: &quot;Ouvrier qualifié - magasinage&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    &#39;67&#39;: &quot;Ouvrier non qualifié de type industriel&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    &#39;68&#39;: &quot;Ouvrier non qualifié de type artisanal&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    &#39;69&#39;: &quot;Ouvrier agricole&quot;, &#39;71&#39;: &quot;Retraité agriculteur exploitant&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    &#39;72&#39;: &quot;Retraité artisan, commerçant, chef d&#39;entreprise&quot;, &#39;73&#39;: &quot;Retraité cadre, profession interm édiaire&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    &#39;76&#39;: &quot;Retraité employé, ouvrier&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    &#39;85&#39;: &quot;Personne sans activité professionnelle &lt; 60 ans&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">    &#39;86&#39;: &quot;Personne sans activité professionnelle &gt; 60 ans&quot; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.identites</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="52">
          <span class="hits">6</span>
          
          <code class="ruby">    [&quot;lien_de_parente&quot;, &quot;prenom&quot;, &quot;nom&quot;, &quot;adresse&quot;, &quot;code_postal&quot;, &quot;ville&quot;, &quot;tel_principal&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">                           &quot;tel_secondaire&quot;, &quot;email&quot;, &quot;profession&quot;, &quot;enfants_a_charge&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">                           &quot;communique_info_parents_eleves&quot;, &quot;lien_avec_eleve&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="38c9a32cd79e121d7d3dd3dec05c3044e2da6a81">
  <div class="header">
    <h3>app/models/tache_import.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TacheImport &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :etablissement</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def traiter</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="5">
          <span class="hits">6</span>
          
          <code class="ruby">    self.update(statut: &#39;en_cours&#39;)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="6">
          <span class="hits">6</span>
          
          <code class="ruby">    case self.traitement</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    when &quot;tout&quot;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="8">
          <span class="hits">5</span>
          
          <code class="ruby">      statistiques = import_xls self.url, self.etablissement_id, self.nom_a_importer, self.prenom_a_importer</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="9">
          <span class="hits">5</span>
          
          <code class="ruby">      self.update(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">        statut: &#39;terminée&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">        message: &quot;#{statistiques[:eleves]} élèves importés : &quot;+</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">        &quot;#{statistiques[:portable]}% de téléphones portables et &quot;+</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        &quot;#{statistiques[:email]}% d&#39;emails&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    when &quot;adresses&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      import_adresses self.url, self.etablissement_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      self.update(statut: &#39;terminée&#39;, message: &quot;Adresses importées&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e9de6ab54b3ed646581e6ac16f8599fc1280a47a">
  <div class="header">
    <h3>app/models/trace.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Trace &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b86887dc0eb56335344883cc6b7fb3ff7797e7af">
  <div class="header">
    <h3>app/uploaders/fichier_uploader.rb</h3>
    <h4><span class="yellow">85.71 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;carrierwave&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;fog-aws&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">class FichierUploader  &lt; CarrierWave::Uploader::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.route_lecture dossier_eleve_id, code_piece</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="6">
          <span class="hits">9</span>
          
          <code class="ruby">    if ENV[&#39;RACK_ENV&#39;] == &quot;test&quot; || !ENV[&#39;S3_KEY&#39;]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="7">
          <span class="hits">9</span>
          
          <code class="ruby">      &quot;/uploads&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="9">
          
          
          <code class="ruby">      &quot;/piece/#{dossier_eleve_id}/#{code_piece}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="74c09cb88b9dca3b72fcf39f0c0bc913f8f63777">
  <div class="header">
    <h3>lib/import_siecle.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>101</b> relevant lines. 
      <span class="green"><b>101</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;roo&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;roo-xls&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">COLONNES = {sexe: 0, nationalite: 1, prenom: 6, prenom_2: 7, prenom_3: 8, nom: 4, date_naiss: 9, identifiant: 11,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">            ville_naiss_etrangere: 20, commune_naiss: 21, pays_naiss: 22, niveau_classe_ant: 33, classe_ant: 34,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">            nom_resp_legal1: 99, prenom_resp_legal1: 101, date_sortie: 13,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">            tel_principal_resp_legal1: 102, tel_secondaire_resp_legal1: 104, lien_de_parente_resp_legal1: 103,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">            adresse_resp_legal1: 108, ville_resp_legal1: 112, code_postal_resp_legal1: 113, email_resp_legal1: 106,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">            nom_resp_legal2: 118, prenom_resp_legal2: 120, tel_principal_resp_legal2: 121,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">            tel_secondaire_resp_legal2: 123, lien_de_parente_resp_legal2: 122, adresse_resp_legal2: 127,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">            ville_resp_legal2: 131, code_postal_resp_legal2: 132, email_resp_legal2: 125}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">def import_adresses fichier, etablissement_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  xls_document = Roo::Spreadsheet.open fichier</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  lignes_siecle = (xls_document.first_row + 1..xls_document.last_row)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  lignes_siecle.each do |row|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">    ligne_siecle = xls_document.row(row)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">    resultat = import_ligne_adresse etablissement_id, ligne_siecle</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">def import_xls fichier, etablissement_id, nom_a_importer=nil, prenom_a_importer=nil</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="24">
          <span class="hits">5</span>
          
          <code class="ruby">  xls_document = Roo::Spreadsheet.open fichier</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="25">
          <span class="hits">5</span>
          
          <code class="ruby">  lignes_siecle = (xls_document.first_row + 1..xls_document.last_row)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="27">
          <span class="hits">5</span>
          
          <code class="ruby">  portables = 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="28">
          <span class="hits">5</span>
          
          <code class="ruby">  emails = 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="29">
          <span class="hits">5</span>
          
          <code class="ruby">  nb_eleves_importes = 0</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="30">
          <span class="hits">5</span>
          
          <code class="ruby">  lignes_siecle.each do |row|</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="31">
          <span class="hits">124</span>
          
          <code class="ruby">    ligne_siecle = xls_document.row(row)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="33">
          <span class="hits">124</span>
          
          <code class="ruby">    resultat = import_ligne etablissement_id, ligne_siecle, nom_a_importer, prenom_a_importer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="35">
          <span class="hits">124</span>
          
          <code class="ruby">    portables += 1 if resultat[:portable]</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="36">
          <span class="hits">124</span>
          
          <code class="ruby">    emails += 1 if resultat[:email]</code>
        </li>
      
        <li class="covered" data-hits="124" data-linenumber="37">
          <span class="hits">124</span>
          
          <code class="ruby">    nb_eleves_importes += 1 if resultat[:eleve_importe]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="39">
          <span class="hits">5</span>
          
          <code class="ruby">  {portable: (portables * 100) / nb_eleves_importes, email: (emails * 100) / nb_eleves_importes,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">   eleves: nb_eleves_importes}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">def import_ligne_adresse etablissement_id, ligne_siecle</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="44">
          <span class="hits">2</span>
          
          <code class="ruby">  eleve = Eleve.find_by(identifiant: ligne_siecle[COLONNES[:identifiant]])</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="45">
          <span class="hits">2</span>
          
          <code class="ruby">  return unless eleve.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">  champs_resp_legal = [:code_postal, :ville]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">  [&#39;1&#39;, &#39;2&#39;].each do |i|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="50">
          <span class="hits">4</span>
          
          <code class="ruby">    donnees_resp_legal = {}</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="51">
          <span class="hits">4</span>
          
          <code class="ruby">    champs_resp_legal.each do |champ|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="52">
          <span class="hits">8</span>
          
          <code class="ruby">      donnees_resp_legal[champ] = ligne_siecle[COLONNES[&quot;#{champ}_resp_legal#{i}&quot;.to_sym]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="55">
          <span class="hits">4</span>
          
          <code class="ruby">    resp_legal = RespLegal.find_by(priorite: i.to_i, dossier_eleve_id: eleve.dossier_eleve.id)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="56">
          <span class="hits">4</span>
          
          <code class="ruby">    resp_legal.update(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        ville_ant: donnees_resp_legal[:ville],</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="58">
          <span class="hits">4</span>
          
          <code class="ruby">        adresse_ant: (concatener_adresse ligne_siecle, resp_legal.priorite),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        code_postal_ant: donnees_resp_legal[:code_postal])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">def concatener_adresse ligne_siecle, priorite</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="64">
          <span class="hits">4</span>
          
          <code class="ruby">  colonnes_adresse = { &#39;resp_legal1&#39; =&gt; [108, 109, 110, 111], &#39;resp_legal2&#39; =&gt; [127, 128, 129, 130]}</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="65">
          <span class="hits">4</span>
          
          <code class="ruby">  adresse = &quot;&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="66">
          <span class="hits">4</span>
          
          <code class="ruby">  colonnes_adresse[&quot;resp_legal#{priorite}&quot;].each do |colonne|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="67">
          <span class="hits">16</span>
          
          <code class="ruby">    adresse &lt;&lt; &quot;#{ligne_siecle[colonne]} \n &quot; unless ligne_siecle[colonne].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="69">
          <span class="hits">4</span>
          
          <code class="ruby">  adresse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">def import_ligne etablissement_id, ligne_siecle, nom_a_importer=nil, prenom_a_importer=nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="75">
          <span class="hits">128</span>
          
          <code class="ruby">  resultat = {portable: false, email: false, eleve_importe: false}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="77">
          <span class="hits">128</span>
          
          <code class="ruby">  champs_eleve = [:sexe,:nationalite, :date_naiss, :prenom, :prenom_2, :prenom_3, :nom,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    :identifiant, :pays_naiss, :commune_naiss, :ville_naiss_etrangere, :classe_ant,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    :niveau_classe_ant]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="81">
          <span class="hits">128</span>
          
          <code class="ruby">  donnees_eleve = {}</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="82">
          <span class="hits">128</span>
          
          <code class="ruby">  champs_eleve.each do |champ|</code>
        </li>
      
        <li class="covered" data-hits="1664" data-linenumber="83">
          <span class="hits">1664</span>
          
          <code class="ruby">    donnees_eleve[champ] = ligne_siecle[COLONNES[champ]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="86">
          <span class="hits">128</span>
          
          <code class="ruby">  donnees_eleve = traiter_donnees_eleve donnees_eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="88">
          <span class="hits">128</span>
          
          <code class="ruby">  return resultat if donnees_eleve[:niveau_classe_ant].nil? || !ligne_siecle[COLONNES[:date_sortie]].nil?</code>
        </li>
      
        <li class="covered" data-hits="119" data-linenumber="89">
          <span class="hits">119</span>
          
          <code class="ruby">  return resultat if (nom_a_importer != nil and nom_a_importer != &#39;&#39;) and donnees_eleve[:nom] != nom_a_importer</code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="90">
          <span class="hits">118</span>
          
          <code class="ruby">  return resultat if (prenom_a_importer != nil and prenom_a_importer != &#39;&#39;) and donnees_eleve[:prenom] != prenom_a_importer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="92">
          <span class="hits">118</span>
          
          <code class="ruby">  eleve = Eleve.find_or_initialize_by(identifiant: donnees_eleve[:identifiant])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="118" data-linenumber="94">
          <span class="hits">118</span>
          
          <code class="ruby">  return resultat if eleve.id.present? &amp;&amp; donnees_eleve[:classe_ant] != eleve.classe_ant</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="96">
          <span class="hits">42</span>
          
          <code class="ruby">  eleve.update_attributes!(donnees_eleve)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="98">
          <span class="hits">42</span>
          
          <code class="ruby">  import_options etablissement_id, ligne_siecle, eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="100">
          <span class="hits">42</span>
          
          <code class="ruby">  dossier_eleve = DossierEleve.find_or_initialize_by(eleve_id: eleve.id)</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="101">
          <span class="hits">42</span>
          
          <code class="ruby">  dossier_eleve.update_attributes!(</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      eleve_id: eleve.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">      etablissement_id: etablissement_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="106">
          <span class="hits">42</span>
          
          <code class="ruby">  champs_resp_legal = [:nom, :prenom, :tel_principal, :tel_secondaire, :lien_de_parente,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    :adresse, :code_postal, :ville, :email]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="109">
          <span class="hits">42</span>
          
          <code class="ruby">  donnees_resp_legal = {}</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="110">
          <span class="hits">42</span>
          
          <code class="ruby">  [&#39;1&#39;, &#39;2&#39;].each do |i|</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="111">
          <span class="hits">84</span>
          
          <code class="ruby">    champs_resp_legal.each do |champ|</code>
        </li>
      
        <li class="covered" data-hits="756" data-linenumber="112">
          <span class="hits">756</span>
          
          <code class="ruby">      donnees_resp_legal[champ] = ligne_siecle[COLONNES[&quot;#{champ}_resp_legal#{i}&quot;.to_sym]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="115">
          <span class="hits">84</span>
          
          <code class="ruby">    donnees_resp_legal[:dossier_eleve_id] = dossier_eleve.id</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="116">
          <span class="hits">84</span>
          
          <code class="ruby">    donnees_resp_legal[:priorite] = i.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="118">
          <span class="hits">84</span>
          
          <code class="ruby">    resp_legal = RespLegal.find_or_initialize_by(dossier_eleve_id: dossier_eleve.id, priorite: i.to_i)</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="119">
          <span class="hits">84</span>
          
          <code class="ruby">    resp_legal.update_attributes!(donnees_resp_legal)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="121">
          <span class="hits">84</span>
          
          <code class="ruby">    resultat[:portable] = true if resp_legal.tel_principal =~ /^0[67]/ or resp_legal.tel_secondaire =~ /^0[67]/</code>
        </li>
      
        <li class="covered" data-hits="84" data-linenumber="122">
          <span class="hits">84</span>
          
          <code class="ruby">    resultat[:email] = true if resp_legal.email =~ /@.*\./</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="125">
          <span class="hits">42</span>
          
          <code class="ruby">  resultat[:eleve_importe] = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="127">
          <span class="hits">42</span>
          
          <code class="ruby">  return resultat</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">def traiter_donnees_eleve donnees_eleve</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="131">
          <span class="hits">128</span>
          
          <code class="ruby">  if donnees_eleve[:sexe] == &#39;M&#39;</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="132">
          <span class="hits">50</span>
          
          <code class="ruby">    donnees_eleve[:sexe] = &#39;Masculin&#39;</code>
        </li>
      
        <li class="covered" data-hits="78" data-linenumber="133">
          <span class="hits">78</span>
          
          <code class="ruby">  elsif donnees_eleve[:sexe] == &#39;F&#39;</code>
        </li>
      
        <li class="covered" data-hits="74" data-linenumber="134">
          <span class="hits">74</span>
          
          <code class="ruby">    donnees_eleve[:sexe] = &#39;Féminin&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="136">
          <span class="hits">128</span>
          
          <code class="ruby">  if donnees_eleve[:date_naiss].class == Date</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="137">
          <span class="hits">14</span>
          
          <code class="ruby">    donnees_eleve[:date_naiss] = donnees_eleve[:date_naiss].strftime(&#39;%Y-%m-%d&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">  else</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="139">
          <span class="hits">114</span>
          
          <code class="ruby">    donnees_eleve[:date_naiss] = donnees_eleve[:date_naiss].split(&#39;/&#39;).reverse.join(&#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="141">
          <span class="hits">128</span>
          
          <code class="ruby">  if donnees_eleve[:pays_naiss] == &#39;FRANCE&#39;</code>
        </li>
      
        <li class="covered" data-hits="106" data-linenumber="142">
          <span class="hits">106</span>
          
          <code class="ruby">    donnees_eleve[:ville_naiss] = donnees_eleve[:commune_naiss]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  else</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="144">
          <span class="hits">22</span>
          
          <code class="ruby">    donnees_eleve[:ville_naiss] = donnees_eleve[:ville_naiss_etrangere]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="146">
          <span class="hits">128</span>
          
          <code class="ruby">  donnees_eleve[:nationalite] = donnees_eleve[:pays_naiss]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="148">
          <span class="hits">128</span>
          
          <code class="ruby">  donnees_eleve.delete(:commune_naiss)</code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="149">
          <span class="hits">128</span>
          
          <code class="ruby">  donnees_eleve.delete(:ville_naiss_etrangere)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="128" data-linenumber="151">
          <span class="hits">128</span>
          
          <code class="ruby">  return donnees_eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="154">
          <span class="hits">1</span>
          
          <code class="ruby">def import_options etablissement_id, ligne_siecle, eleve</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  colonnes_options = [</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="156">
          <span class="hits">42</span>
          
          <code class="ruby">    {cle_gestion: 37, libelle: 38, code_modalite: 39},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    {cle_gestion: 41, libelle: 42, code_modalite: 43},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    {cle_gestion: 45, libelle: 46, code_modalite: 47},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    {cle_gestion: 49, libelle: 50, code_modalite: 51},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    {cle_gestion: 53, libelle: 54, code_modalite: 55},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">    {cle_gestion: 57, libelle: 58, code_modalite: 59},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    {cle_gestion: 61, libelle: 62, code_modalite: 63},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    {cle_gestion: 65, libelle: 66, code_modalite: 67},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    {cle_gestion: 69, libelle: 70, code_modalite: 71},</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    {cle_gestion: 73, libelle: 74, code_modalite: 75}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  ]</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="167">
          <span class="hits">42</span>
          
          <code class="ruby">  colonnes_options.each do |colonne|</code>
        </li>
      
        <li class="covered" data-hits="420" data-linenumber="168">
          <span class="hits">420</span>
          
          <code class="ruby">    libelle = ligne_siecle[colonne[:libelle]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="420" data-linenumber="170">
          <span class="hits">420</span>
          
          <code class="ruby">    unless libelle.nil?</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="171">
          <span class="hits">85</span>
          
          <code class="ruby">      cle_gestion = ligne_siecle[colonne[:cle_gestion]]</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="172">
          <span class="hits">85</span>
          
          <code class="ruby">      code_modalite = ligne_siecle[colonne[:code_modalite]]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="174">
          <span class="hits">85</span>
          
          <code class="ruby">      option = creer_option libelle, cle_gestion, code_modalite</code>
        </li>
      
        <li class="covered" data-hits="85" data-linenumber="175">
          <span class="hits">85</span>
          
          <code class="ruby">      eleve.option &lt;&lt; option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="180">
          <span class="hits">1</span>
          
          <code class="ruby">def creer_option libelle, cle_gestion, code_modalite</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="181">
          <span class="hits">92</span>
          
          <code class="ruby">  cle_groupes = {AGL1: &quot;Langue vivante 1&quot;, ESP2: &quot;Langue vivante 2&quot;, ES2ND: &quot;Langue vivante 2&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby">    ALL2: &quot;Langue vivante 2&quot;, AL2ND: &quot;Langue vivante 2&quot;, LCALA: &quot;Langues et cultures de l&#39;antiquité&quot;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    LCAGR: &quot;Langues et cultures de l&#39;antiquité&quot;, DANSE: &quot;Autres enseignements&quot;}</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="184">
          <span class="hits">92</span>
          
          <code class="ruby">  cle_noms = {&#39;ANGLAIS LV1&#39;: &#39;Anglais&#39;, &#39;ESPAGNOL LV2&#39;: &#39;Espagnol&#39;, &#39;ESPAGNOL LV2 ND&#39;: &#39;Espagnol non débutant&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">    &#39;ALLEMAND LV2&#39;: &#39;Allemand&#39;, &#39;ALLEMAND LV2 ND&#39;: &#39;Allemand non débutant&#39;, &#39;LCA LATIN&#39;: &#39;Latin&#39;, &#39;LCA GREC&#39;: &#39;Grec&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">    &#39;DANSE&#39;: &#39;Danse&#39;}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="188">
          <span class="hits">92</span>
          
          <code class="ruby">  obligatoire = code_modalite == &#39;O&#39;</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="189">
          <span class="hits">92</span>
          
          <code class="ruby">  groupe = cle_groupes[cle_gestion.to_sym]</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="190">
          <span class="hits">92</span>
          
          <code class="ruby">  nom = cle_noms[libelle.to_sym]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="192">
          <span class="hits">92</span>
          
          <code class="ruby">  option = Option.find_or_initialize_by(nom: nom, groupe: groupe, modalite: obligatoire ? &#39;obligatoire&#39; : &#39;facultative&#39;)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="193">
          <span class="hits">92</span>
          
          <code class="ruby">  option.save!</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="194">
          <span class="hits">92</span>
          
          <code class="ruby">  option</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dde11c2785996ef3d12577dbb43c6f5f822fecd6">
  <div class="header">
    <h3>lib/traitement.rb</h3>
    <h4><span class="yellow">89.09 %</span> covered</h4>
    <div>
      <b>55</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;import_siecle&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">def traiter_imports</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">  tache = TacheImport.find_by(statut: &#39;en_attente&#39;)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="5">
          <span class="hits">7</span>
          
          <code class="ruby">  return unless tache</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="6">
          <span class="hits">6</span>
          
          <code class="ruby">  tache.traiter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">def traiter_messages</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="10">
          
          
          <code class="ruby">  message = Message.find_by(etat: &#39;en_attente&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">  return unless message</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="12">
          
          
          <code class="ruby">  message.envoyer</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">def get_fichier_s3 nom_fichier</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="16">
          <span class="hits">3</span>
          
          <code class="ruby">  if ENV[&#39;S3_KEY&#39;].present?</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="17">
          
          
          <code class="ruby">    connection = Fog::Storage.new({</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">                      provider: &#39;AWS&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">                      aws_access_key_id: ENV[&#39;S3_KEY&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">                      aws_secret_access_key: ENV[&#39;S3_SECRET&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">                      region: ENV[&#39;S3_REGION&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">                      path_style: true # indispensable pour éviter l&#39;erreur &quot;hostname does not match the server certificate&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">                  })</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="24">
          
          
          <code class="ruby">    bucket = connection.directories.get(&#39;dossierscoweb&#39;)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="25">
          
          
          <code class="ruby">    bucket.files.get(&quot;uploads/#{nom_fichier}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # On crée un objet qui émule le comportement de l&#39;objet Fog::Storage::AWS::File</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # à savoir une méthode URL avec un paramètre de délai de validité et qui renvoie</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    # une URL (en remote) ou un chemin de fichier (en local)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="30">
          <span class="hits">3</span>
          
          <code class="ruby">    fichier = Object.new</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="31">
          <span class="hits">3</span>
          
          <code class="ruby">    fichier.define_singleton_method(:url) do |x|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">      &quot;public/uploads/#{nom_fichier}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">    fichier</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">def genere_pdf eleve</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  Prawn::Document.new do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 30</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    float do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      bounding_box([320, cursor], :width =&gt; 200) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;#{eleve.dossier_eleve.etablissement.ville}, le #{Time.now.strftime(&#39;%e %B %Y&#39;)}&quot;, :align =&gt; :center</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        move_down 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;#{eleve.dossier_eleve.etablissement.nom}&quot;, :align =&gt; :center</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;#{eleve.dossier_eleve.etablissement.adresse}&quot;, :align =&gt; :center</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;#{eleve.dossier_eleve.etablissement.code_postal} #{eleve.dossier_eleve.etablissement.ville}&quot;, :align =&gt; :center</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;&lt;b&gt;Inscription au collège&lt;/b&gt;&quot;, :inline_format =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 80</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;Madame, Monsieur,&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 30</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;  Pour que votre enfant #{eleve.prenom} #{eleve.nom} poursuive sa scolarité au collège, veuillez vous munir des pièces suivantes :&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    float do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">      bounding_box([30, cursor], :width =&gt; 500) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - document 1&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - document 2&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - document 3&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - document 4&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - document 5&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 80</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;Vous pouvez les photographier avec votre téléphone ou les scanner avec votre ordinateur.&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;Dans les deux cas rendez-vous sur le site avant le #{eleve.dossier_eleve.etablissement.date_limite} :&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 30</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;&lt;b&gt;dossiersco.herokuapp.com&lt;/b&gt;&quot;, :inline_format =&gt; true, :align =&gt; :center</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 30</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;Vous entrerez :&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 10</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">    float do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">      bounding_box([30, cursor], :width =&gt; 500) do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - Identifiant : #{eleve.identifiant}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">        text &quot;  - La date de naissance de l&#39;élève&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">    move_down 70</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">    text &quot;Si vous ne souhaitez pas faire l&#39;inscription en ligne, rendez-vous au collège : #{eleve.dossier_eleve.etablissement.message_permanence}.&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
