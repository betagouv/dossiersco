<!doctype html>

<html lang="fr">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/yadcf/0.9.3/jquery.dataTables.yadcf.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/select/1.2.6/css/select.dataTables.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <title>DossierSCO : l’inscription au collège</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'agent', 'data-turbolinks-track': 'reload' %>

  </head>

  <body>

    <header class="navbar navbar-expand-lg navbar-light bg-white">
      <div class="navbar-logo">
        <%= link_to root_path do %>
          <img src='/images/republique_francaise.svg' class='logo'>
          <span class="navbar-brand" >DossierSCO</span>
        <% end %>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

      <div class="collapse navbar-collapse navbar-links" id="navbarSupportedContent">
        <ul class="navbar-nav">
          <% unless @agent_connecté.nil? %>
            <% if @agent_connecté.admin? %>
              <li class="nav-item">
                <%= link_to t('.configuration'), configuration_path, {class: 'nav-link'}%>
              </li>
            <% end %>
            <% if super_admin?(@agent_connecté.identifiant) %>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                                                                                               aria-haspopup="true" aria-expanded="false">
                  <%= @agent_connecté.etablissement.nom %>
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <% Etablissement.all.each do |etablissement| %>
                    <%= link_to "#{etablissement.nom} (#{etablissement.departement})", changer_etablissement_configuration_agent_path(@agent_connecté, etablissement: etablissement), {method: :post, class: 'dropdown-item'} %>
                  <% end %>
                </div>
              </li>
            <% else %>
              <li class="nav-item">
                <span class="nav-link"><%= @agent_connecté.etablissement.nom %></span>
              </li>
            <% end %>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                                                                                             aria-haspopup="true" aria-expanded="false">
                <%= @agent_connecté.identifiant %>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <%= link_to 'Mon profil', edit_configuration_agent_path(@agent_connecté), {class: "dropdown-item"} %>
                <%= link_to "Se déconnecter", agent_deconnexion_path, {class: "dropdown-item"} %>
              </div>
            </li>
          <% end %>
        </ul>
      </div>

    </header>

    <nav class="menu-agents pl-5 navbar navbar-expand-lg navbar-light bg-white">
      <ul class="navbar-nav ml-5">
        <li class="nav-item <%= 'active' if request.fullpath.include? '/tableau_de_bord' %>">
          <%= link_to 'Tableau de bord', agent_tableau_de_bord_path, {class: 'nav-link'} %>
        </li>
        <li class="nav-item <%= 'active' if request.fullpath.include? '/liste_des_eleves' %>">
          <%= link_to 'Liste des élèves', agent_liste_des_eleves_path, {class: 'nav-link'} %>
        </li>
        <li class="nav-item <%= 'active' if request.fullpath.include? '/convocations' %>">
          <%= link_to 'Convocations', agent_convocations_path, {class: 'nav-link'} %>
        </li>
        <li class="nav-item <%= 'active' if request.fullpath.include? '/export' %>">
          <%= link_to 'Export', agent_export_path, {class: 'nav-link'} %>
        </li>
      </ul>
    </nav>


    <main role="main" class="container my-5">

    <% if flash[:notice] %>
      <div class="alert alert-success" role="alert">
        <%= flash[:notice]  %>
      </div>
    <% elsif flash[:alert] %>
      <div class="alert alert-danger" role="alert">
        <%= flash[:alert]  %>
      </div>
    <% end %>
    <div class="row justify-content-center">

      <% if (defined? message_info) && (!message_info.nil?) %>
        <div class="alert alert-success"><%= message_info %></div>
      <% end %>

      <%= yield %>

    </div>

    </main>
    <script>
      drift.identify(<%= @agent_connecté.id %>, {
        email: '<%= @agent_connecté.email %>',
        name: '<%= @agent_connecté.prenom %> <%= @agent_connecté.nom %> (<%= @agent_connecté.etablissement.nom %>)',
        postalcode: '<%= @agent_connecté.etablissement.code_postal %>',
        city: '<%= @agent_connecté.etablissement.ville %>'
      })
    </script>
  </body>
</html>
